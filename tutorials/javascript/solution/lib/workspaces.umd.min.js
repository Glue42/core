!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).workspaces=e.workspaces||{},e.workspaces.min=t())}(this,(function(){"use strict";function e(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function a(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){e.done?n(e.value):new r((function(t){t(e.value)})).then(s,a)}d((i=i.apply(e,t||[])).next())}))}function t(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,r={};function i(r,i){var n=r instanceof Error?r:new Error(r);if(t)t(n);else{var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+n.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t){var i=r[e];return i||(i=[],r[e]=i),i.push(t),function(){var i=r[e];i&&(i=i.reduce((function(e,r,i){return r===t&&e.length===i||e.push(r),e}),[]),r[e]=i)}},execute:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=r[e];if(!o||0===o.length)return[];var s=[];return o.forEach((function(r){try{var n=r.apply(void 0,t);s.push(n)}catch(t){s.push(void 0),i(t,e)}})),s},clear:function(){r={}},clearKey:function(e){r[e]&&delete r[e]}}}t.default=t;var r=t,i=function(e){return{ok:!0,result:e}},n=function(e){return{ok:!1,error:e}},o=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},s=function(e,t){return!0===t.ok?t.result:e},a=function(e){if(!0===e.ok)return e.result;throw e.error},d=function(e,t){return!0===t.ok?i(e(t.result)):t},c=function(e,t,r){return!1===t.ok?t:!1===r.ok?r:i(e(t.result,r.result))},u=function(e,t){return!0===t.ok?t:n(e(t.error))},l=function(e,t){return!0===t.ok?e(t.result):t},h=(Object.freeze({ok:i,isOk:function(e){return!0===e.ok},err:n,isErr:function(e){return!1===e.ok},asPromise:o,withDefault:s,withException:a,successes:function(e){return e.reduce((function(e,t){return!0===t.ok?e.concat(t.result):e}),[])},map:d,map2:c,mapError:u,andThen:l}),function(){return(h=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)});var m=function(e){return Array.isArray(e)},f=function(e){return"object"==typeof e&&null!==e&&!m(e)},p=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},w=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},g=function(e,t){var r=t.at,i=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}(t,["at"]);return h({at:e+(r||"")},i)},v=function(){function e(t){var r=this;this.decode=t,this.run=function(e){return u((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),r.decode(e))},this.runPromise=function(e){return o(r.run(e))},this.runWithException=function(e){return a(r.run(e))},this.map=function(t){return new e((function(e){return d(t,r.decode(e))}))},this.andThen=function(t){return new e((function(e){return l((function(r){return t(r).decode(e)}),r.decode(e))}))},this.where=function(t,i){return r.andThen((function(r){return t(r)?e.succeed(r):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?i(e):n({message:p("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?i(e):n({message:p("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?i(e):n({message:p("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return function e(t,r){if(t===r)return!0;if(null===t&&null===r)return!0;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)){if(!Array.isArray(r))return!1;if(t.length!==r.length)return!1;for(var i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}var n=Object.keys(t);if(n.length!==Object.keys(r).length)return!1;for(i=0;i<n.length;i++){if(!r.hasOwnProperty(n[i]))return!1;if(!e(t[n[i]],r[n[i]]))return!1}return!0}}(e,t)?i(t):n({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(f(e)&&t){var r={};for(var o in t)if(t.hasOwnProperty(o)){var s=t[o].decode(e[o]);if(!0!==s.ok)return void 0===e[o]?n({message:"the key '"+o+"' is required but was not present"}):n(g("."+o,s.error));void 0!==s.result&&(r[o]=s.result)}return i(r)}return f(e)?i(e):n({message:p("an object",e)})}))},e.array=function(t){return new e((function(e){if(m(e)&&t){return e.reduce((function(e,r,i){return c((function(e,t){return e.concat([t])}),e,function(e,r){return u((function(e){return g("["+r+"]",e)}),t.decode(e))}(r,i))}),i([]))}return m(e)?i(e):n({message:p("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(m(e)){if(e.length!==t.length)return n({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var r=[],o=0;o<t.length;o++){var s=t[o].decode(e[o]);if(!s.ok)return n(g("["+o+"]",s.error));r[o]=s.result}return i(r)}return n({message:p("a tuple of length "+t.length,e)})}))},e.union=function(t,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return e.oneOf.apply(e,[t,r].concat(i))},e.intersection=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return new e((function(e){return[t,r].concat(n).reduce((function(t,r){return c(Object.assign,t,r.decode(e))}),i({}))}))},e.anyJson=function(){return new e((function(e){return i(e)}))},e.unknownJson=function(){return new e((function(e){return i(e)}))},e.dict=function(t){return new e((function(e){if(f(e)){var r={};for(var o in e)if(e.hasOwnProperty(o)){var s=t.decode(e[o]);if(!0!==s.ok)return n(g("."+o,s.error));r[o]=s.result}return i(r)}return n({message:p("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e?i(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new e((function(e){for(var r=[],i=0;i<t.length;i++){var o=t[i].decode(e);if(!0===o.ok)return o;r[i]=o.error}var s=r.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return n({message:'expected a value matching one of the decoders, got the errors ["'+s+'"]'})}))},e.withDefault=function(t,r){return new e((function(e){return i(s(t,r.decode(e)))}))},e.valueAt=function(t,r){return new e((function(e){for(var i=e,o=0;o<t.length;o++){if(void 0===i)return n({at:w(t.slice(0,o+1)),message:"path does not exist"});if("string"==typeof t[o]&&!f(i))return n({at:w(t.slice(0,o+1)),message:p("an object",i)});if("number"==typeof t[o]&&!m(i))return n({at:w(t.slice(0,o+1)),message:p("an array",i)});i=i[t[o]]}return u((function(e){return void 0===i?{at:w(t),message:"path does not exist"}:g(w(t),e)}),r.decode(i))}))},e.succeed=function(t){return new e((function(e){return i(t)}))},e.fail=function(t){return new e((function(e){return n({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),y=v.string,I=v.number,k=v.boolean,b=v.anyJson,W=v.constant,S=v.object,x=v.array,F=v.optional,C=v.oneOf,D=v.intersection,T=v.lazy;const E=y().where(e=>e.length>0,"Expected a non-empty string"),L=I().where(e=>e>=0,"Expected a non-negative number"),M=S({inWorkspace:k()}),A=C(W("workspace"),W("row"),W("column"),W("group")),B=C(W("row"),W("column"),W("group")),P=(e,t)=>{const r=typeof e;if(t&&"function"!==r&&"undefined"!==r)throw new Error("Provided argument must be either undefined or of type function, provided: "+r);if(!t&&"function"!==r)throw new Error("Provided argument must be of type function, provided: "+r)},R=F(S({saveLayout:F(k())})),O=S({name:E}),z=S({type:F(W("window")),appName:F(E),windowId:F(E),context:F(b())}),j=S({type:W("window"),appName:F(E),windowId:F(E),context:F(b())}),G=F(S({type:F(B),children:F(T(()=>x(C(z,G))))})),U=S({type:B,children:F(T(()=>x(C(j,U))))}),$=(C(y().where(e=>"maximized"===e.toLowerCase(),"Expected a case insensitive variation of 'maximized'"),y().where(e=>"normal"===e.toLowerCase(),"Expected a case insensitive variation of 'normal'")),S({bounds:F(S({left:F(I()),top:F(I()),width:F(L),height:F(L)}))})),_=C(W("direct"),W("delayed"),W("lazy")),N=F(S({app:F(E),context:F(b()),restoreType:F(_),title:F(E),reuseWorkspaceId:F(E),frameId:F(E),lockdown:F(k()),activateFrame:F(k()),newFrame:F(C($,k())),inMemoryLayout:F(k())})),J=S({name:E,restoreOptions:F(N)}),H=S({children:F(x(C(z,G))),context:F(b()),config:F(S({title:F(E),position:F(L),isFocused:F(k())})),frame:F(S({reuseFrameId:F(E),newFrame:F(C(k(),$))}))}),K=S({type:A,definition:F(C(H,G))}),q=D(H,S({saveConfig:F(S({saveLayout:F(k())}))})),Q=S({itemId:E}),V=S({id:E}),X=(S({id:E,frameId:E,positionIndex:I(),title:E,focused:k()}),S({type:B,id:E,frameId:E,workspaceId:E,positionIndex:I()}),S({type:C(W("frame"),W("workspace"),W("container"),W("window")),branch:E})),Y=C(W("opened"),W("closing"),W("closed"),W("focus"),W("added"),W("loaded"),W("removed"),W("childrenUpdate"),W("containerChange")),Z=S({frameId:E,title:E,positionIndex:L,name:E}),ee=S({frameId:E,workspaceId:E,positionIndex:L}),te=b(),re=D(ee,S({windowId:F(E),isMaximized:k(),isLoaded:k(),isFocused:k(),title:F(y()),appName:F(E)})),ie=S({id:E,config:C(te,re),children:F(T(()=>x(ie))),type:C(W("window"),W("row"),W("column"),W("group"))}),ne=S({id:E,config:Z,children:x(ie),frameSummary:V}),oe=S({id:F(E),config:C(te,re),children:F(T(()=>x(oe))),type:C(W("window"),W("row"),W("column"),W("group"))}),se=S({type:W("window"),config:S({appName:E,url:F(E)})}),ae=S({type:W("group"),config:b(),children:x(C(se))}),de=S({type:W("column"),config:b(),children:x(C(ae,se,T(()=>de),T(()=>ce)))}),ce=S({type:W("row"),config:b(),children:x(C(de,ae,se,T(()=>ce)))}),ue=S({name:E,type:W("Workspace"),metadata:F(b()),components:x(S({type:W("Workspace"),state:S({config:b(),children:x(C(ce,de,ae,se))})}))}),le=S({layouts:x(ue)}),he=S({id:E}),me=S({summaries:x(he)}),fe=S({id:E,config:Z}),pe=S({summaries:x(fe)}),we=S({id:E,config:b(),workspaces:x(ne)}),ge=S({name:E}),ve=S({summaries:x(ge)}),ye=S({windowId:E}),Ie=b(),ke=S({width:F(L),height:F(L),relative:F(k())}),be=S({top:F(I()),left:F(I()),relative:F(k())}),We=S({itemId:E}),Se=S({itemId:E,title:E}),xe=S({itemId:E,containerId:E}),Fe=D(We,ke),Ce=D(We,be),De=(S({id:E,type:B}),S({definition:z,parentId:E,parentType:A})),Te=S({definition:U,parentId:E,parentType:A}),Ee=S({itemId:E,windowId:F(E)}),Le=S({type:C(W("row"),W("column")),workspaceId:E}),Me=S({itemId:E,config:te}),Ae=S({frameSummary:V}),Be=S({workspaceSummary:fe,frameSummary:V}),Pe=S({containerSummary:Me}),Re=S({windowSummary:S({itemId:E,parentId:E,config:re})}),Oe=S({name:E,workspaceId:E}),ze={control:{name:"T42.Workspaces.Control",isStream:!1},frameStream:{name:"T42.Workspaces.Stream.Frame",isStream:!0},workspaceStream:{name:"T42.Workspaces.Stream.Workspace",isStream:!0},containerStream:{name:"T42.Workspaces.Stream.Container",isStream:!0},windowStream:{name:"T42.Workspaces.Stream.Window",isStream:!0}},je={frame:{name:"T42.Workspaces.Stream.Frame",payloadDecoder:Ae},workspace:{name:"T42.Workspaces.Stream.Workspace",payloadDecoder:Be},container:{name:"T42.Workspaces.Stream.Container",payloadDecoder:Pe},window:{name:"T42.Workspaces.Stream.Window",payloadDecoder:Re}},Ge={isWindowInWorkspace:{name:"isWindowInWorkspace",argsDecoder:We,resultDecoder:M},createWorkspace:{name:"createWorkspace",resultDecoder:ne,argsDecoder:q},getAllFramesSummaries:{name:"getAllFramesSummaries",resultDecoder:me},getFrameSummary:{name:"getFrameSummary",resultDecoder:V,argsDecoder:Q},getAllWorkspacesSummaries:{name:"getAllWorkspacesSummaries",resultDecoder:pe},getWorkspaceSnapshot:{name:"getWorkspaceSnapshot",resultDecoder:ne,argsDecoder:We},getAllLayoutsSummaries:{name:"getAllLayoutsSummaries",resultDecoder:ve},openWorkspace:{name:"openWorkspace",argsDecoder:J,resultDecoder:ne},deleteLayout:{name:"deleteLayout",resultDecoder:Ie,argsDecoder:O},saveLayout:{name:"saveLayout",resultDecoder:ue,argsDecoder:Oe},importLayout:{name:"importLayout",resultDecoder:Ie,argsDecoder:ue},exportAllLayouts:{name:"exportAllLayouts",resultDecoder:le},restoreItem:{name:"restoreItem",argsDecoder:We,resultDecoder:Ie},maximizeItem:{name:"maximizeItem",argsDecoder:We,resultDecoder:Ie},focusItem:{name:"focusItem",argsDecoder:We,resultDecoder:Ie},closeItem:{name:"closeItem",argsDecoder:We,resultDecoder:Ie},resizeItem:{name:"resizeItem",argsDecoder:Fe,resultDecoder:Ie},moveFrame:{name:"moveFrame",argsDecoder:Ce,resultDecoder:Ie},getFrameSnapshot:{name:"getFrameSnapshot",argsDecoder:We,resultDecoder:we},forceLoadWindow:{name:"forceLoadWindow",argsDecoder:We,resultDecoder:ye},ejectWindow:{name:"ejectWindow",argsDecoder:We,resultDecoder:Ie},setItemTitle:{name:"setItemTitle",argsDecoder:Se,resultDecoder:Ie},moveWindowTo:{name:"moveWindowTo",argsDecoder:xe,resultDecoder:Ie},addWindow:{name:"addWindow",argsDecoder:De,resultDecoder:Ee},addContainer:{name:"addContainer",argsDecoder:Te,resultDecoder:Ee},bundleWorkspace:{name:"bundleWorkspace",argsDecoder:Le,resultDecoder:Ie}};class Ue{constructor(e,t){this.bridge=e,this.base=t}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Ge.isWindowInWorkspace.name,{itemId:t})).inWorkspace}))}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r});return yield this.base.createWorkspace(e)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);if(null==r?void 0:r.frameId){if(!(yield this.bridge.send(Ge.getAllFramesSummaries.name)).summaries.some(e=>e.id===r.frameId))throw new Error(`Cannot reuse the frame with id: ${r.frameId}, because there is no frame with that ID found`)}return yield this.base.restoreWorkspace(t,r)}))}add(t,r,i,n){return e(this,void 0,void 0,(function*(){return yield this.base.add(t,r,i,n)}))}processLocalSubscription(e,t){return e.levelId=e.levelId||t,this.bridge.subscribe(e)}processGlobalSubscription(e,t,r){const i={streamType:t,callback:e,action:r,level:"global"};return this.bridge.subscribe(i)}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId)return yield this.base.getFrame(t.windowId);if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Ge.getAllFramesSummaries.name);return this.base.getFrames(e.summaries,t)}))}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Ge.getAllWorkspacesSummaries.name,{});return this.base.getAllWorkspaceSummaries(e)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getWindow(t);n&&(e=n,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getBox(t);n&&(e=n,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Ge.getAllLayoutsSummaries.name)).summaries}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.deleteLayout.name,{name:t})}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Ge.exportAllLayouts.name)).layouts.reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}saveLayout(t){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(Ge.saveLayout.name,{name:t.name,workspaceId:t.workspaceId})}))}importLayout(t){return e(this,void 0,void 0,(function*(){yield Promise.all(t.map(e=>this.bridge.send(Ge.importLayout.name,e)))}))}bundleTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.bundleTo(t,r)}))}restoreItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.restoreItem(t)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.maximizeItem(t)}))}focusItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.focusItem(t)}))}closeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.closeItem(t)}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.resizeItem(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){return yield this.base.forceLoadWindow(t)}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){return yield this.base.ejectWindow(t)}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveWindowTo(t,r)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.getSnapshot(t,r)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.setItemTitle(t,r)}))}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const n of i){if(e)return;const i=yield this.base.fetchWorkspace(n.id);t(i,r)}}))}}class $e{constructor(e,t){this.transport=e,this.registry=t,this.activeSubscriptions=[]}send(t,r,i){return e(this,void 0,void 0,(function*(){if(!window.glue42gd&&!i)throw new Error(`Cannot complete operation: ${t} with args: ${JSON.stringify(r)}, because the environment is Glue42 Core and no frame target was provided`);const e=Object.values(Ge).find(e=>e.name===t);if(!e)throw new Error("Cannot find definition for operation name: "+t);if(e.argsDecoder)try{e.argsDecoder.runWithException(r)}catch(e){throw new Error(`Unexpected internal outgoing validation error: ${e.message}, for input: ${JSON.stringify(e.input)}`)}let n;try{const t=yield this.transport.transmitControl(e.name,r,i);n=e.resultDecoder.runWithException(t)}catch(e){if(e.kind)throw new Error(`Unexpected internal incoming validation error: ${e.message}, for input: ${JSON.stringify(e.input)}`);throw new Error(e.message)}return n}))}subscribe(t){return e(this,void 0,void 0,(function*(){let e=this.getActiveSubscription(t);const r=this.getRegistryKey(t);if(!e){const r=je[t.streamType],i=yield this.transport.subscribe(r.name,this.getBranchKey(t),t.streamType);i.onData(e=>{const t=e.data,r=X.run(e.requestArguments),i=Y.run(t.action);if(!r.ok||!i.ok)return;const n=r.result.type,o=r.result.branch,s=je[n].payloadDecoder.run(t.payload);if(!s.ok)return;const a=`${n}-${o}-${i.result}`;this.registry.execute(a,s.result)}),e={streamType:t.streamType,level:t.level,levelId:t.levelId,callbacksCount:0,gdSub:i},this.activeSubscriptions.push(e)}const i=this.registry.add(r,t.callback);return++e.callbacksCount,()=>{i(),--e.callbacksCount,0===e.callbacksCount&&(e.gdSub.close(),this.activeSubscriptions.splice(this.activeSubscriptions.indexOf(e),1))}}))}getBranchKey(e){return"global"===e.level?e.level:`${e.level}_${e.levelId}`}getRegistryKey(e){return`${e.streamType}-${this.getBranchKey(e)}-${e.action}`}getActiveSubscription(e){return this.activeSubscriptions.find(t=>t.streamType===e.streamType&&t.level===e.level&&t.levelId===e.levelId)}}class _e{constructor(e){this.agm=e,this.defaultTransportTimeout=3e4}initiate(){return e(this,void 0,void 0,(function*(){window.glue42gd&&(yield Promise.all(Object.values(ze).map(e=>this.verifyMethodLive(e.name,e.isStream))))}))}subscribe(t,r,i){return e(this,void 0,void 0,(function*(){const e={branch:r,type:i};let n;try{n=yield this.agm.subscribe(t,{arguments:e})}catch(e){const i=`Internal subscription error! Error details: stream - ${t}, branch: ${r}. Internal message: ${e.message}`;throw new Error(i)}return n}))}transmitControl(t,r,i){return e(this,void 0,void 0,(function*(){if(!this.agm.methods().find(e=>e.name===ze.control.name))throw new Error(`Cannot complete operation: ${t}, because no control method was found`);const e={operation:t,operationArguments:r};let n;const o=`Internal Workspaces Communication Error. Attempted operation: ${JSON.stringify(e)}. `;try{if(n=yield this.agm.invoke(ze.control.name,e,i,{methodResponseTimeoutMs:this.defaultTransportTimeout}),!n)throw new Error("Received unsupported result from GD - empty result");if(!Array.isArray(n.all_return_values)||0===n.all_return_values.length)throw new Error("Received unsupported result from GD - empty values collection")}catch(e){if(e&&e.all_errors&&e.all_errors.length){const t=e.all_errors[0].message;throw new Error(`${o} -> Inner message: ${t}`)}throw new Error(`${o} -> Inner message: ${e.message}`)}return n.all_return_values[0].returned}))}verifyMethodLive(e,t){return r=()=>new Promise(r=>{if(this.agm.methods().find(r=>r.name===e&&r.supportsStreaming===t))return void r();let i=this.agm.methodAdded(n=>{n.name===e&&n.supportsStreaming===t&&(i?(i(),i=null):setTimeout(()=>{i&&i()},0),r())})}),i=15e3,n="Timeout waiting for the Workspaces communication channels",new Promise((e,t)=>{let o=!0;const s=setTimeout(()=>{o&&(o=!1,t(n||"Promise timeout hit: "+i))},i);r().then(t=>{o&&(o=!1,clearTimeout(s),e(t))}).catch(e=>{o&&(o=!1,clearTimeout(s),t(e))})});var r,i,n}}const Ne=new WeakMap;class Je{constructor(e,t){const r=t.wrapChildren(e.children);delete e.children,Ne.set(this,{base:t,children:r,definition:e})}get type(){return Ne.get(this).definition.type}addColumn(e){return Ne.get(this).base.add("column",Ne.get(this).children,e)}addRow(e){return Ne.get(this).base.add("row",Ne.get(this).children,e)}addGroup(e){return Ne.get(this).base.add("group",Ne.get(this).children,e)}addWindow(e){return Ne.get(this).base.addWindow(Ne.get(this).children,e),this}serialize(){const e=Ne.get(this).definition;return e.children=Ne.get(this).base.serializeChildren(Ne.get(this).children),e}}class He{constructor(e){this.getBuilder=e}wrapChildren(e){return e.map(e=>"window"===e.type?e:this.getBuilder({type:e.type,definition:e}))}add(e,t,r){const i=G.runWithException(r),n=this.getBuilder({type:e,definition:i});return t.push(n),n}addWindow(e,t){const r=z.runWithException(t);r.type="window",e.push(r)}serializeChildren(e){return e.map(e=>e instanceof Je?e.serialize():e)}}const Ke=new WeakMap;class qe{constructor(e,t,r){const i=t.wrapChildren(e.children);delete e.children,Ke.set(this,{base:t,children:i,definition:e,controller:r})}addColumn(e){const t=Ke.get(this).children;if(!t.every(e=>e instanceof Je&&"column"===e.type))throw new Error("Cannot add a column to this workspace, because there are already children of another type");return Ke.get(this).base.add("column",t,e)}addRow(e){const t=Ke.get(this).children;if(!t.every(e=>e instanceof Je&&"row"===e.type))throw new Error("Cannot add a row to this workspace, because there are already children of another type");return Ke.get(this).base.add("row",t,e)}addGroup(e){const t=Ke.get(this).children;if(0!==t.length)throw new Error("Cannot add a group to this workspace, because there are already defined children.");return Ke.get(this).base.add("group",t,e)}addWindow(e){const t=Ke.get(this).children;if(0!==t.length)throw new Error("Cannot add a window to this workspace, because there are already defined children.");return Ke.get(this).base.addWindow(t,e),this}getChildAt(e){L.runWithException(e);return Ke.get(this).children[e]}create(t){return e(this,void 0,void 0,(function*(){const e=R.runWithException(t),r=Ke.get(this).definition;r.children=Ke.get(this).base.serializeChildren(Ke.get(this).children);return Ke.get(this).controller.createWorkspace(r,e)}))}}const Qe=new WeakMap,Ve=e=>Qe.get(e).base;class Xe{constructor(e){Qe.set(this,{base:e})}get type(){return"row"}get id(){return Ve(this).getId(this)}get frameId(){return Ve(this).getFrameId(this)}get workspaceId(){return Ve(this).getWorkspaceId(this)}get positionIndex(){return Ve(this).getPositionIndex(this)}get children(){return Ve(this).getAllChildren(this)}get parent(){return Ve(this).getMyParent(this)}get frame(){return Ve(this).getMyFrame(this)}get workspace(){return Ve(this).getMyWorkspace(this)}addWindow(e){return Ve(this).addWindow(this,e,"row")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Ve(this).addParent(this,"group","row",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"column"!==t.type)throw new Error("Expected a column definition, but received "+t.type);return Ve(this).addParent(this,"column","row",t)}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as row children is not supported")}))}removeChild(e){return Ve(this).removeChild(this,e)}maximize(){return Ve(this).maximize(this)}restore(){return Ve(this).restore(this)}close(){return Ve(this).close(this)}}const Ye=new WeakMap,Ze=e=>Ye.get(e).base;class et{constructor(e){Ye.set(this,{base:e})}get type(){return"column"}get id(){return Ze(this).getId(this)}get frameId(){return Ze(this).getFrameId(this)}get workspaceId(){return Ze(this).getWorkspaceId(this)}get positionIndex(){return Ze(this).getPositionIndex(this)}get children(){return Ze(this).getAllChildren(this)}get parent(){return Ze(this).getMyParent(this)}get frame(){return Ze(this).getMyFrame(this)}get workspace(){return Ze(this).getMyWorkspace(this)}addWindow(e){return Ze(this).addWindow(this,e,"column")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Ze(this).addParent(this,"group","column",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as column children is not supported")}))}addRow(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"row"!==t.type)throw new Error("Expected a row definition, but received "+t.type);return Ze(this).addParent(this,"row","column",t)}))}removeChild(e){return Ze(this).removeChild(this,e)}maximize(){return Ze(this).maximize(this)}restore(){return Ze(this).restore(this)}close(){return Ze(this).close(this)}}const tt=new WeakMap,rt=e=>tt.get(e).base;class it{constructor(e){tt.set(this,{base:e})}get type(){return"group"}get id(){return rt(this).getId(this)}get frameId(){return rt(this).getFrameId(this)}get workspaceId(){return rt(this).getWorkspaceId(this)}get positionIndex(){return rt(this).getPositionIndex(this)}get children(){return rt(this).getAllChildren(this)}get parent(){return rt(this).getMyParent(this)}get frame(){return rt(this).getMyFrame(this)}get workspace(){return rt(this).getMyWorkspace(this)}addWindow(e){return rt(this).addWindow(this,e,"group")}addGroup(){return e(this,void 0,void 0,(function*(){throw new Error("Adding groups as group child is not supported")}))}addColumn(){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as group child is not supported")}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as group child is not supported")}))}removeChild(e){return rt(this).removeChild(this,e)}maximize(){return rt(this).maximize(this)}restore(){return rt(this).restore(this)}close(){return rt(this).close(this)}}const nt=new WeakMap,ot=e=>nt.get(e).manager.getWorkspaceData(e),st=e=>nt.get(e).manager;class at{constructor(e){nt.set(this,{manager:e})}get id(){return ot(this).id}get frameId(){return ot(this).config.frameId}get positionIndex(){return ot(this).config.positionIndex}get title(){return ot(this).config.title}get children(){return ot(this).children}get frame(){return ot(this).frame}removeChild(t){return e(this,void 0,void 0,(function*(){P(t);const e=this.children.find(t);e&&(yield e.close(),yield this.refreshReference())}))}remove(t){return e(this,void 0,void 0,(function*(){P(t);const e=ot(this).controller.iterateFindChild(this.children,t);yield e.close(),yield this.refreshReference()}))}focus(){return e(this,void 0,void 0,(function*(){yield ot(this).controller.focusItem(this.id),yield this.refreshReference()}))}close(){return e(this,void 0,void 0,(function*(){const e=ot(this).controller,t=1===(yield ot(this).frame.workspaces()).length?ot(this).frame:null;yield e.closeItem(this.id,t)}))}snapshot(){return ot(this).controller.getSnapshot(this.id,"workspace")}saveLayout(t){return e(this,void 0,void 0,(function*(){E.runWithException(t),yield ot(this).controller.saveLayout({name:t,workspaceId:this.id})}))}setTitle(t){return e(this,void 0,void 0,(function*(){E.runWithException(t);const e=ot(this).controller;yield e.setItemTitle(this.id,t),yield this.refreshReference()}))}refreshReference(){return e(this,void 0,void 0,(function*(){const e=yield ot(this).controller.getSnapshot(this.id,"workspace"),t=e.children.reduce((e,t)=>{let r;return r="window"===t.type?this.getWindow(e=>e.id===t.id):this.getBox(e=>e.id===t.id),r&&e.push(r),e},[]),r=ot(this).controller.refreshChildren({existingChildren:t,workspace:this,parent:this,children:e.children}),i=this.frame;let n;if(i.id===e.config.frameId)st(this).remapFrame(i,e.frameSummary),n=i;else{const t={summary:e.frameSummary};n=ot(this).ioc.getModel("frame",t)}st(this).remapWorkspace(this,{config:e.config,children:r,frame:n})}))}getBox(e){P(e);const t=ot(this).children;return ot(this).controller.iterateFindChild(t,t=>"window"!==t.type&&e(t))}getAllBoxes(e){P(e,!0);const t=ot(this).children,r=ot(this).controller.iterateFilterChildren(t,e=>"window"!==e.type);return e?r.filter(e):r}getRow(e){return P(e),this.getBox(t=>"row"===t.type&&e(t))}getAllRows(e){return P(e,!0),e?this.getAllBoxes(t=>"row"===t.type&&e(t)):this.getAllBoxes(e=>"row"===e.type)}getColumn(e){return P(e),this.getBox(t=>"column"===t.type&&e(t))}getAllColumns(e){return P(e,!0),e?this.getAllBoxes(t=>"column"===t.type&&e(t)):this.getAllBoxes(e=>"column"===e.type)}getGroup(e){return P(e),this.getBox(t=>"group"===t.type&&e(t))}getAllGroups(e){return P(e,!0),e?this.getAllBoxes(t=>"group"===t.type&&e(t)):this.getAllBoxes(e=>"group"===e.type)}getWindow(e){P(e);const t=ot(this).children;return ot(this).controller.iterateFindChild(t,t=>"window"===t.type&&e(t))}getAllWindows(e){P(e,!0);const t=ot(this).children,r=ot(this).controller.iterateFilterChildren(t,e=>"window"===e.type);return e?r.filter(e):r}addRow(e){return ot(this).base.addParent(this,"row","workspace",e)}addColumn(e){return ot(this).base.addParent(this,"column","workspace",e)}addGroup(e){return ot(this).base.addParent(this,"group","workspace",e)}addWindow(e){return ot(this).base.addWindow(this,e,"workspace")}bundleToRow(){return e(this,void 0,void 0,(function*(){yield ot(this).controller.bundleTo("row",this.id),yield this.refreshReference()}))}bundleToColumn(){return e(this,void 0,void 0,(function*(){yield ot(this).controller.bundleTo("column",this.id),yield this.refreshReference()}))}onClosing(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"closing",streamType:"workspace",level:"workspace",levelId:r,callback:()=>e(this,void 0,void 0,(function*(){yield this.refreshReference(),t()}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onClosed(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"closed",streamType:"workspace",level:"workspace",levelId:r,callback:()=>e(this,void 0,void 0,(function*(){t()}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onFocusChange(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"focus",streamType:"workspace",level:"workspace",levelId:r,callback:()=>e(this,void 0,void 0,(function*(){yield this.refreshReference(),t()}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"added",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getBox(e=>e.id===r.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"removed",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const{windowId:e,workspaceId:i,frameId:n}=r.windowSummary.config;t({windowId:e,workspaceId:i,frameId:n})}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"loaded",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getWindow(e=>e.id&&e.id===r.windowSummary.config.windowId);t(e)}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onWindowFocusChange(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"focus",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){this.refreshReference();const e=this.getWindow(e=>e.id&&e.id===r.windowSummary.config.windowId);t(e)}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onBoxAdded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"added",streamType:"container",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getBox(e=>e.id===r.containerSummary.itemId);t(e)}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onBoxRemoved(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"removed",streamType:"container",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const{workspaceId:e,frameId:i}=r.containerSummary.config;t({id:r.containerSummary.itemId,workspaceId:e,frameId:i})}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}onBoxUpdated(t){return e(this,void 0,void 0,(function*(){P(t);const r=ot(this).id,i={action:"childrenUpdate",streamType:"container",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getBox(e=>e.id===r.containerSummary.itemId);t(e)}))};return yield ot(this).controller.processLocalSubscription(i,r)}))}}const dt=new WeakMap,ct=e=>dt.get(e).manager.getWindowData(e);class ut{constructor(e){dt.set(this,{manager:e})}get id(){return ct(this).config.windowId}get type(){return"window"}get frameId(){return ct(this).frame.id}get workspaceId(){return ct(this).workspace.id}get positionIndex(){return ct(this).config.positionIndex}get isMaximized(){return ct(this).config.isMaximized}get isLoaded(){return ct(this).config.isLoaded}get focused(){return ct(this).config.isFocused}get title(){return ct(this).config.title}get workspace(){return ct(this).workspace}get frame(){return ct(this).frame}get parent(){return ct(this).parent}get appName(){return ct(this).config.appName}forceLoad(){return e(this,void 0,void 0,(function*(){if(this.isLoaded)return;const e=ct(this).controller,t=ct(this).id,r=yield e.forceLoadWindow(t);ct(this).config.windowId=r,ct(this).config.isLoaded=!0}))}focus(){return e(this,void 0,void 0,(function*(){const e=ct(this).id,t=ct(this).controller;yield t.focusItem(e)}))}close(){return e(this,void 0,void 0,(function*(){const e=ct(this).id,t=ct(this).controller;yield t.closeItem(e),yield ct(this).parent.removeChild(t=>t.id===e)}))}setTitle(t){return e(this,void 0,void 0,(function*(){E.runWithException(t);const e=ct(this).id,r=ct(this).controller;yield r.setItemTitle(e,t)}))}maximize(){return e(this,void 0,void 0,(function*(){const e=ct(this).id,t=ct(this).controller;yield t.maximizeItem(e)}))}restore(){return e(this,void 0,void 0,(function*(){const e=ct(this).id,t=ct(this).controller;yield t.restoreItem(e)}))}eject(){return e(this,void 0,void 0,(function*(){if(!this.isLoaded)throw new Error("Cannot eject this window, because it is not loaded yet");const e=ct(this).id;return yield ct(this).controller.ejectWindow(e),this.getGdWindow()}))}getGdWindow(){if(!this.isLoaded)throw new Error("Cannot fetch this GD window, because the window is not yet loaded");const e=ct(this).config.windowId;return ct(this).controller.getGDWindow(e)}moveTo(t){return e(this,void 0,void 0,(function*(){if(!(t instanceof Xe||t instanceof et||t instanceof it))throw new Error("Cannot add to the provided parent, because the provided parent is not an instance of Row, Column or Group");const e=ct(this).id,r=ct(this).controller;if(!(yield r.getParent(e=>e.id===t.id)))throw new Error("Cannot move the window to the selected parent, because this parent does not exist.");return r.moveWindowTo(e,t.id)}))}onAdded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ct(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"added",streamType:"window",level:"window"};return yield ct(this).controller.processLocalSubscription(i,r)}))}onLoaded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ct(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"loaded",streamType:"window",level:"window"};return yield ct(this).controller.processLocalSubscription(i,r)}))}onParentChanged(t){return e(this,void 0,void 0,(function*(){P(t);const r=ct(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t(this.parent)})),action:"containerChange",streamType:"window",level:"window"};return yield ct(this).controller.processLocalSubscription(i,r)}))}onRemoved(t){return e(this,void 0,void 0,(function*(){P(t);const r=ct(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"removed",streamType:"window",level:"window"};return yield ct(this).controller.processLocalSubscription(i,r)}))}}const lt=new WeakMap,ht=e=>lt.get(e).manager.getFrameData(e),mt=e=>lt.get(e).manager;class ft{constructor(e){lt.set(this,{manager:e})}get id(){return ht(this).summary.id}resize(e){const t=ke.runWithException(e),r=ht(this).summary.id;return ht(this).controller.resizeItem(r,t)}move(e){const t=be.runWithException(e),r=ht(this).summary.id;return ht(this).controller.moveFrame(r,t)}focus(){const e=ht(this).summary.id;return ht(this).controller.focusItem(e)}close(){const e=ht(this).summary.id;return ht(this).controller.closeItem(e)}snapshot(){const e=ht(this).summary.id;return ht(this).controller.getSnapshot(e,"frame")}workspaces(){return e(this,void 0,void 0,(function*(){return ht(this).controller.getWorkspaces(e=>e.frameId===this.id)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){E.runWithException(t);const e=N.runWithException(r);return ht(this).controller.restoreWorkspace(t,e)}))}createWorkspace(e,t){const r=H.runWithException(e),i=R.runWithException(t);return ht(this).controller.createWorkspace(r,i)}onClosing(t){return e(this,void 0,void 0,(function*(){P(t);const e=ht(this).summary.id,r={callback:e=>{mt(this).remapFrame(this,e.frameSummary),t(this)},action:"closing",streamType:"frame",level:"frame"};return yield ht(this).controller.processLocalSubscription(r,e)}))}onClosed(t){return e(this,void 0,void 0,(function*(){P(t);const e=ht(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id})},action:"closed",streamType:"frame",level:"frame"};return yield ht(this).controller.processLocalSubscription(r,e)}))}onFocusChange(t){return e(this,void 0,void 0,(function*(){P(t);const e=ht(this).summary.id,r={callback:e=>{mt(this).remapFrame(this,e.frameSummary),t(this)},action:"focus",streamType:"frame",level:"frame"};return yield ht(this).controller.processLocalSubscription(r,e)}))}onWorkspaceOpened(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ht(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"added",streamType:"workspace",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}onWorkspaceFocusChange(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ht(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"focus",streamType:"workspace",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}onWorkspaceClosing(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ht(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"focus",streamType:"workspace",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}onWorkspaceClosed(t){return e(this,void 0,void 0,(function*(){P(t);const e=ht(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},action:"closed",streamType:"workspace",level:"frame"};return yield ht(this).controller.processLocalSubscription(r,e)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield ht(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"added",streamType:"window",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){P(t);const e=ht(this).summary.id,r={callback:e=>{const{windowId:r,workspaceId:i,frameId:n}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:n})},action:"removed",streamType:"window",level:"frame"};return yield ht(this).controller.processLocalSubscription(r,e)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield ht(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"loaded",streamType:"window",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}onWindowFocusChange(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield ht(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"focus",streamType:"window",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}onBoxAdded(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ht(this).controller.getParent(e=>e.id===r.containerSummary.itemId);t(e)})),action:"added",streamType:"container",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}onBoxRemoved(t){return e(this,void 0,void 0,(function*(){P(t);const e=ht(this).summary.id,r={callback:e=>{const{workspaceId:r,frameId:i}=e.containerSummary.config;t({id:e.containerSummary.itemId,workspaceId:r,frameId:i})},action:"removed",streamType:"container",level:"frame"};return yield ht(this).controller.processLocalSubscription(r,e)}))}onBoxUpdated(t){return e(this,void 0,void 0,(function*(){P(t);const r=ht(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ht(this).controller.getParent(e=>e.id===r.containerSummary.itemId);t(e)})),action:"childrenUpdate",streamType:"container",level:"frame"};return yield ht(this).controller.processLocalSubscription(i,r)}))}}class pt{constructor(){this.parentsData=new WeakMap,this.workspacesData=new WeakMap,this.windowsData=new WeakMap,this.framesData=new WeakMap,this.windowPlacementIdData={}}deleteData(e){if(e instanceof ut){const t=Object.keys(this.windowPlacementIdData).find(t=>this.windowPlacementIdData[t]===e);t&&delete this.windowPlacementIdData[t],this.windowsData.delete(e)}e instanceof at&&this.workspacesData.delete(e),(e instanceof Xe||e instanceof et||e instanceof it)&&this.parentsData.delete(e),e instanceof ft&&this.framesData.delete(e)}setWindowData(e,t){this.windowPlacementIdData[t.id]=e,this.windowsData.set(e,t)}setWorkspaceData(e,t){this.workspacesData.set(e,t)}setParentData(e,t){this.parentsData.set(e,t)}setFrameData(e,t){this.framesData.set(e,t)}getWindowData(e){return this.windowsData.get(e)}getWindowByPlacementId(e){return this.windowPlacementIdData[e]}getWorkspaceData(e){return this.workspacesData.get(e)}getParentData(e){return this.parentsData.get(e)}getFrameData(e){return this.framesData.get(e)}remapChild(e,t){if(e instanceof ut){const r=this.windowsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config}if(e instanceof Xe||e instanceof et||e instanceof it){const r=this.parentsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config,r.children=t.children||r.children}}remapFrame(e,t){this.framesData.get(e).summary=t}remapWorkspace(e,t){const r=this.workspacesData.get(e);r.frame=t.frame||r.frame,r.config=t.config||r.config,r.children=t.children||r.children}}const wt=new WeakMap,gt=(e,t)=>{const r=wt.get(e).manager;return t instanceof at?r.getWorkspaceData(t):wt.get(e).manager.getParentData(t)},vt=(e,t)=>wt.get(e).manager.getWindowByPlacementId(t);class yt{constructor(e){wt.set(this,{manager:e})}getId(e){return gt(this,e).id}getPositionIndex(e){return gt(this,e).config.positionIndex}getWorkspaceId(e){const t=gt(this,e);return t.config.workspaceId||t.workspace.id}getFrameId(e){return gt(this,e).frame.id}getAllChildren(e,t){P(t,!0);const r=gt(this,e).children;return void 0===t?r:r.filter(t)}getMyParent(e){if(!(e instanceof at))return gt(this,e).parent}getMyFrame(e){return gt(this,e).frame}getMyWorkspace(e){if(!(e instanceof at))return gt(this,e).workspace}addWindow(t,r,i){return e(this,void 0,void 0,(function*(){if(!r.appName&&!r.windowId)throw new Error("The window definition should contain either an appName or a windowId");const e=z.runWithException(r),n=gt(this,t).controller,o=yield n.add("window",gt(this,t).id,i,e);return t instanceof at?(yield t.refreshReference(),vt(this,o.itemId)):(yield this.getMyWorkspace(t).refreshReference(),vt(this,o.itemId))}))}addParent(t,r,i,n){return e(this,void 0,void 0,(function*(){const e=this.transformDefinition(r,n),o=gt(this,t).controller,s=(yield o.add("container",gt(this,t).id,i,e)).itemId;if(t instanceof at)return yield t.refreshReference(),t.getBox(e=>e.id===s);const a=this.getMyWorkspace(t);return yield a.refreshReference(),a.getBox(e=>e.id===s)}))}removeChild(t,r){return e(this,void 0,void 0,(function*(){P(r);const e=this.getAllChildren(t).find(r);e&&(yield e.close(),t instanceof at?yield t.refreshReference():yield this.getMyWorkspace(t).refreshReference())}))}maximize(t){return e(this,void 0,void 0,(function*(){const e=gt(this,t).controller;yield e.maximizeItem(gt(this,t).id)}))}restore(t){return e(this,void 0,void 0,(function*(){const e=gt(this,t).controller;yield e.restoreItem(gt(this,t).id)}))}close(t){return e(this,void 0,void 0,(function*(){const e=gt(this,t),r=gt(this,t).controller;yield r.closeItem(e.id),e.parent instanceof at?yield e.parent.refreshReference():yield this.getMyWorkspace(e.parent).refreshReference()}))}transformDefinition(e,t){let r;return void 0===t?r={type:e,children:[]}:t instanceof Je?r=t.serialize():(void 0===t.type&&(t.type=e),r=U.runWithException(t),r.children=r.children||[]),r}}class It{constructor(e,t,r,i){this.bridge=e,this.frameUtils=t,this.layouts=r,this.base=i}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){const e=this.frameUtils.getAllFrameInstances();if(!e.length)return!1;return(yield Promise.all(e.map(e=>this.bridge.send(Ge.isWindowInWorkspace.name,{itemId:t},e)))).some(e=>e.inWorkspace)}))}createWorkspace(t,r){var i,n;return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r}),o={frameId:null===(i=t.frame)||void 0===i?void 0:i.reuseFrameId,newFrame:null===(n=t.frame)||void 0===n?void 0:n.newFrame},s=yield this.frameUtils.getFrameInstance(o),a=yield this.base.createWorkspace(e,s);return yield this.frameUtils.focusFrame(s),a}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);const e=yield this.frameUtils.getFrameInstance({frameId:null==r?void 0:r.frameId,newFrame:null==r?void 0:r.newFrame}),i=yield this.base.restoreWorkspace(t,r,e);return yield this.frameUtils.focusFrame(e),i}))}add(t,r,i,n){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(r);return yield this.base.add(t,r,i,n,e)}))}processLocalSubscription(){return e(this,void 0,void 0,(function*(){throw new Error("Workspaces events are not supported in Glue42 Core.")}))}processGlobalSubscription(){return e(this,void 0,void 0,(function*(){throw new Error("Workspaces events are not supported in Glue42 Core.")}))}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId){const e=yield this.frameUtils.getFrameInstanceByItemId(t.windowId);return yield this.base.getFrame(t.windowId,e)}if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=this.frameUtils.getAllFrameInstances(),r=yield Promise.all(e.map(e=>this.bridge.send(Ge.getFrameSummary.name,{itemId:e.peerId},e)));return this.base.getFrames(r,t)}))}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=this.frameUtils.getAllFrameInstances(),t=yield Promise.all(e.map(e=>this.bridge.send(Ge.getAllWorkspacesSummaries.name,{},e)));return this.base.getAllWorkspaceSummaries(...t)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getWindow(t);n&&(e=n,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getBox(t);n&&(e=n,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.layouts.getAll("Workspace")).map(e=>({name:e.name}))}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.layouts.remove("Workspace",t)}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.layouts.export("Workspace")).reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}importLayout(t){return e(this,void 0,void 0,(function*(){yield this.layouts.import(t)}))}saveLayout(t){return e(this,void 0,void 0,(function*(){if(!this.frameUtils.getAllFrameInstances().length)throw new Error(`Cannot save the layout with config: ${JSON.stringify(t)}, because no active frames were found`);const e=yield this.frameUtils.getFrameInstanceByItemId(t.workspaceId);return yield this.bridge.send(Ge.saveLayout.name,{name:t.name,workspaceId:t.workspaceId},e)}))}bundleTo(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(r);return yield this.base.bundleTo(t,r,e)}))}restoreItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.restoreItem(t,e)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.maximizeItem(t,e)}))}focusItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.focusItem(t,e)}))}closeItem(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t),i=t===e.peerId;return yield this.base.closeItem(t,e),i?yield this.frameUtils.closeFrame(e):r?yield r.close():void 0}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.resizeItem(t,r,e),yield this.frameUtils.resizeFrame(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.moveFrame(t,r,e),yield this.frameUtils.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.forceLoadWindow(t,e)}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.ejectWindow(t,e)}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.moveWindowTo(t,r,e)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.getSnapshot(t,r,e)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.setItemTitle(t,r,e)}))}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const n of i){if(e)return;const i=yield this.frameUtils.getFrameInstance({frameId:n.frameId}),o=yield this.base.fetchWorkspace(n.id,i);t(o,r)}}))}}class kt{constructor(e,t,r,i){this.interop=e,this.windows=t,this.bridge=r,this.assetsBaseLocation=i,this.workspacesIndex="/workspaces/",this.defaultAssetsBase="/glue",this.defaultWidth=1280,this.defaultHeight=720;const n=location.href.includes("csb.app")?"/index.html":"";this.workspacesRoute=`${this.assetsBaseLocation||this.defaultAssetsBase}${this.workspacesIndex}${n}`}getAllFrameInstances(){return this.interop.servers().filter(e=>{var t;if(null==e?void 0:e.getMethods)return null===(t=e.getMethods())||void 0===t?void 0:t.some(e=>e.name===ze.control.name)})}focusFrame(t){return e(this,void 0,void 0,(function*(){const e=this.windows.list().find(e=>e.id===t.windowId);yield e.focus()}))}getFrameInstance(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.frameId)&&(null==t?void 0:t.newFrame))throw new Error("Cannot retrieve the frame, because of over-specification: both frameId and newFrame were provided.");const e=this.getAllFrameInstances();if(null==t?void 0:t.frameId){const r=e.find(e=>e.peerId===t.frameId);if(!r)throw new Error(`Frame with id: ${t.frameId} was not found`);return r}return(null==t?void 0:t.newFrame)?this.openNewWorkspacesFrame(t.newFrame):e.length?this.getLastFrameInteropInstance():this.openNewWorkspacesFrame()}))}getFrameInstanceByItemId(t){return e(this,void 0,void 0,(function*(){const e=this.getAllFrameInstances(),r=(yield Promise.all(e.map(e=>this.bridge.send(Ge.getFrameSummary.name,{itemId:t},e)))).find(e=>"none"!==e.id);if(!r)throw new Error("Cannot find frame for item: "+t);return yield this.getFrameInstance({frameId:r.id})}))}getLastFrameInteropInstance(){return this.getAllFrameInstances().sort((e,t)=>{const r=(null==e?void 0:e.peerId)?+e.peerId.slice(e.peerId.lastIndexOf("-")+1):0;return((null==t?void 0:t.peerId)?+t.peerId.slice(t.peerId.lastIndexOf("-")+1):0)-r})[0]}openNewWorkspacesFrame(e){return new Promise((t,r)=>{var i,n;const o=this.getAllFrameInstances().length;let s;const a=this.interop.serverMethodAdded(e=>{if(!(null==e?void 0:e.server)||!(null==e?void 0:e.method))return;const r=e.method.name===ze.control.name,i=e.server.windowId===(null==s?void 0:s.id);(null==s?void 0:s.id)&&r&&i&&(a(),t(e.server))}),d={url:this.workspacesRoute+"?emptyFrame=true",width:"object"==typeof e&&(null===(i=e.bounds)||void 0===i?void 0:i.width)||this.defaultWidth,height:"object"==typeof e&&(null===(n=e.bounds)||void 0===n?void 0:n.height)||this.defaultHeight};this.windows.open("frame_"+(o+1),d.url,d).then(e=>{s=e;const r=this.interop.servers().find(e=>{const t=e.windowId===s.id,r=e.getMethods().some(e=>e.name===ze.control.name);return t&&r});r&&(a(),t(r))}).catch(r)})}closeFrame(t){return e(this,void 0,void 0,(function*(){const e=this.windows.list().find(e=>e.id===t.windowId);yield e.close()}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.getFrameInstanceByItemId(t);if(t!==e.peerId)return;const i=this.windows.list().find(t=>t.id===e.windowId);r.relative?yield i.moveTo(r.top,r.left):yield i.moveResize({top:r.top,left:r.left})}))}resizeFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.getFrameInstanceByItemId(t);if(t!==e.peerId)return;const i=this.windows.list().find(t=>t.id===e.windowId);r.relative?yield i.resizeTo(r.width,r.height):yield i.moveResize({width:r.width,height:r.height})}))}}class bt{constructor(e,t){this.ioc=e,this.windows=t}get bridge(){return this.ioc.bridge}get privateDataManager(){return this.ioc.privateDataManager}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Ge.createWorkspace.name,t,r),i={summary:e.frameSummary},n={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",n)}))}restoreWorkspace(t,r,i){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Ge.openWorkspace.name,{name:t,restoreOptions:r},i),n={summary:yield this.bridge.send(Ge.getFrameSummary.name,{itemId:e.config.frameId},i)},o={frame:this.ioc.getModel("frame",n),snapshot:e};return this.ioc.getModel("workspace",o)}))}add(t,r,i,n,o){return e(this,void 0,void 0,(function*(){let e;const s={definition:n,parentId:r,parentType:i};if("window"===t)e=Ge.addWindow.name;else{if("container"!==t)throw new Error("Unrecognized add type: "+t);e=Ge.addContainer.name}return yield this.bridge.send(e,s,o)}))}getFrame(t,r){return e(this,void 0,void 0,(function*(){const e={summary:yield this.bridge.send(Ge.getFrameSummary.name,{itemId:t},r)};return this.ioc.getModel("frame",e)}))}getFrames(e,t){return e.reduce((e,r)=>{const i={summary:r},n=this.ioc.getModel("frame",i);return t&&!t(n)||e.push(n),e},[])}getAllWorkspaceSummaries(...e){return e.reduce((e,t)=>(e.push(...t.summaries),e),[]).map(e=>({id:e.id,frameId:e.config.frameId,positionIndex:e.config.positionIndex,title:e.config.title}))}fetchWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(Ge.getWorkspaceSnapshot.name,{itemId:t},r),i={summary:e.frameSummary},n={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",n)}))}bundleTo(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.bundleWorkspace.name,{type:t,workspaceId:r},i)}))}restoreItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.restoreItem.name,{itemId:t},r)}))}maximizeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.maximizeItem.name,{itemId:t},r)}))}focusItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.focusItem.name,{itemId:t},r)}))}closeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.closeItem.name,{itemId:t},r)}))}resizeItem(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.resizeItem.name,Object.assign({},{itemId:t},r),i)}))}moveFrame(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.moveFrame.name,Object.assign({},{itemId:t},r),i)}))}getGDWindow(e){return this.windows.list().find(t=>t.id===e)}forceLoadWindow(t,r){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(Ge.forceLoadWindow.name,{itemId:t},r)).windowId}))}ejectWindow(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.ejectWindow.name,{itemId:t},r)}))}moveWindowTo(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.moveWindowTo.name,{itemId:t,containerId:r},i)}))}getSnapshot(t,r,i){return e(this,void 0,void 0,(function*(){let e;return"workspace"===r?e=yield this.bridge.send(Ge.getWorkspaceSnapshot.name,{itemId:t},i):"frame"===r&&(e=yield this.bridge.send(Ge.getFrameSnapshot.name,{itemId:t},i)),e}))}setItemTitle(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(Ge.setItemTitle.name,{itemId:t,title:r},i)}))}refreshChildren(e){const{parent:t,children:r,existingChildren:i,workspace:n}=e;if(t instanceof ut)return;const o=r.map(e=>{let r=i.find(t=>t.id===e.id);const o=e.type;if(r)this.privateDataManager.remapChild(r,{parent:t,children:[],config:e.config});else if("window"===o){const i={id:e.id,parent:t,frame:n.frame,workspace:n,config:e.config};r=this.ioc.getModel(o,i)}else{const i={id:e.id,children:[],parent:t,frame:n.frame,workspace:n,config:e.config};r=this.ioc.getModel(o,i)}return"window"!==o&&this.refreshChildren({workspace:n,existingChildren:i,children:e.children,parent:r}),r});return t instanceof at||this.privateDataManager.remapChild(t,{children:o}),o}iterateFindChild(e,t){let r=e.find(e=>t(e));return r||(e.some(e=>!(e instanceof ut)&&(r=this.iterateFindChild(e.children,t),!!r||void 0)),r)}iterateFilterChildren(e,t){const r=e.filter(e=>t(e)),i=e.reduce((e,r)=>(r instanceof ut||e.push(...this.iterateFilterChildren(r.children,t)),e),[]);return r.push(...i),r}}class Wt{constructor(e,t,r,i){this.agm=e,this.windows=t,this.layouts=r,this.assetsBaseLocation=i}get baseController(){return this._baseController||(this._baseController=new bt(this,this.windows)),this._baseController}get controller(){return this._controllerInstance||(this._controllerInstance=window.glue42gd?new Ue(this.bridge,this.baseController):new It(this.bridge,new kt(this.agm,this.windows,this.bridge,this.assetsBaseLocation),this.layouts,this.baseController)),this._controllerInstance}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new $e(this.transport,r())),this._bridgeInstance}get transport(){return this._transportInstance||(this._transportInstance=new _e(this.agm)),this._transportInstance}get privateDataManager(){return this._privateDataManagerInstance||(this._privateDataManagerInstance=new pt),this._privateDataManagerInstance}get parentBase(){return this._parentBaseInstance||(this._parentBaseInstance=new yt(this.privateDataManager)),this._parentBaseInstance}initiate(){return e(this,void 0,void 0,(function*(){yield this.transport.initiate()}))}getModel(e,t){switch(e){case"frame":{const e=new ft(this.privateDataManager),{summary:r}=t,i={summary:r,controller:this.controller};return this.privateDataManager.setFrameData(e,i),e}case"window":{const{id:e,parent:r,frame:i,workspace:n,config:o}=t,s={type:"window",controller:this.controller,config:o,id:e,parent:r,frame:i,workspace:n},a=new ut(this.privateDataManager);return this.privateDataManager.setWindowData(a,s),a}case"row":case"column":case"group":{const{id:r,children:i,parent:n,frame:o,workspace:s,config:a}=t,d="column"===e?new et(this.parentBase):"row"===e?new Xe(this.parentBase):new it(this.parentBase),c=this.buildChildren(i,o,s,d),u={id:r,parent:n,frame:o,workspace:s,config:a,type:e,controller:this.controller,children:c};return this.privateDataManager.setParentData(d,u),d}case"workspace":{const{snapshot:e,frame:r}=t,i=new at(this.privateDataManager),n=this.buildChildren(e.children,r,i,i),o={id:e.id,type:"workspace",config:e.config,base:this.parentBase,controller:this.controller,children:n,frame:r,ioc:this};return this.privateDataManager.setWorkspaceData(i,o),i}default:throw new Error("Unrecognized type: "+e)}}getBuilder(e){e.definition=e.definition||{},Array.isArray(e.definition.children)||(e.definition.children=[]);const t=new He(this.getBuilder.bind(this));switch(e.type){case"workspace":return new qe(e.definition,t,this.controller);case"row":case"column":case"group":return e.definition.type=e.type,new Je(e.definition,t);default:throw new Error("Unexpected Builder creation error, provided config: "+JSON.stringify(e))}}buildChildren(e,t,r,i){return e.map(e=>{switch(e.type){case"window":return this.getModel("window",{id:e.id,config:e.config,frame:t,workspace:r,parent:i});case"column":case"row":case"group":return this.getModel(e.type,{id:e.id,config:e.config,children:e.children,frame:t,workspace:r,parent:i});default:throw new Error("Unsupported child type: "+e.type)}})}}const St=(t,r)=>e(void 0,void 0,void 0,(function*(){var i;const n=new Wt(t.agm,t.windows,t.layouts,null===(i=null==r?void 0:r.assets)||void 0===i?void 0:i.location);yield n.initiate(),t.workspaces=((t,r)=>{const i=r.controller;return{inWorkspace:()=>{const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");return i.checkIsInSwimlane(e)},getBuilder:e=>{const t=K.runWithException(e);return r.getBuilder(t)},getMyFrame:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your frame, because this window is not in a workspace");return i.getFrame({windowId:e})})),getFrame:t=>e(void 0,void 0,void 0,(function*(){return P(t),i.getFrame({predicate:t})})),getAllFrames:t=>e(void 0,void 0,void 0,(function*(){return P(t,!0),i.getFrames(t)})),getAllWorkspacesSummaries:()=>i.getAllWorkspaceSummaries(),getMyWorkspace:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my workspace, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your workspace, because this window is not in a workspace");return(yield i.getWorkspaces(t=>!!t.getWindow(t=>t.id===e)))[0]})),getWorkspace:t=>e(void 0,void 0,void 0,(function*(){return P(t),(yield i.getWorkspaces(t))[0]})),getAllWorkspaces:e=>(P(e,!0),i.getWorkspaces(e)),getWindow:t=>e(void 0,void 0,void 0,(function*(){return P(t),i.getWindow(t)})),getBox:t=>e(void 0,void 0,void 0,(function*(){return P(t),i.getParent(t)})),restoreWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){E.runWithException(t);const e=N.runWithException(r);return i.restoreWorkspace(t,e)})),createWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){const e=H.runWithException(t),n=R.runWithException(r);return i.createWorkspace(e,n)})),layouts:{getSummaries:()=>i.getLayoutSummaries(),delete:t=>e(void 0,void 0,void 0,(function*(){return E.runWithException(t),i.deleteLayout(t)})),export:t=>e(void 0,void 0,void 0,(function*(){return P(t,!0),i.exportLayout(t)})),import:t=>e(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))throw new Error("The provided layouts argument is not an array: "+JSON.stringify(t));return t.forEach(e=>ue.runWithException(e)),i.importLayout(t)})),save:t=>e(void 0,void 0,void 0,(function*(){const e=Oe.runWithException(t);return i.saveLayout(e)}))},onFrameOpened:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},n=r.getModel("frame",i);t(n)},"frame","opened")})),onFrameClosing:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},n=r.getModel("frame",i);t(n)},"frame","closing")})),onFrameClosed:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id})},"frame","closed")})),onFrameFocusChange:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},n=r.getModel("frame",i);t(n)},"frame","focus")})),onWorkspaceOpened:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e={summary:n.frameSummary},o={frame:r.getModel("frame",e),snapshot:yield i.getSnapshot(n.workspaceSummary.id,"workspace")},s=r.getModel("workspace",o);t(s)})),"workspace","opened")})),onWorkspaceClosing:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e={summary:n.frameSummary},o={frame:r.getModel("frame",e),snapshot:yield i.getSnapshot(n.workspaceSummary.id,"workspace")},s=r.getModel("workspace",o);t(s)})),"workspace","closing")})),onWorkspaceClosed:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},"workspace","closed")})),onWorkspaceFocusChange:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e={summary:n.frameSummary},o={frame:r.getModel("frame",e),snapshot:yield i.getSnapshot(n.workspaceSummary.id,"workspace")},s=r.getModel("workspace",o);t(s)})),"workspace","focus")})),onWindowAdded:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getBox(e=>e.id===n.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===n.windowSummary.config.positionIndex);t(a)})),"window","added")})),onWindowLoaded:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getWindow(e=>e.id&&e.id===n.windowSummary.config.windowId);t(a)})),"window","loaded")})),onWindowRemoved:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(e=>{const{windowId:r,workspaceId:i,frameId:n}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:n})},"window","removed")})),onWindowFocusChange:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getWindow(e=>e.id&&e.id===n.windowSummary.config.windowId);t(a)})),"window","focus")})),onBoxAdded:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.containerSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getBox(e=>e.id===n.containerSummary.itemId);t(a)})),"container","added")})),onBoxRemoved:t=>e(void 0,void 0,void 0,(function*(){P(t);return yield i.processGlobalSubscription(e=>{const{workspaceId:r,frameId:i}=e.containerSummary.config;t({id:e.containerSummary.itemId,workspaceId:r,frameId:i})},"container","removed")}))}})(t,n)}));return"undefined"!=typeof window&&(window.GlueWorkspaces=St),St}));
//# sourceMappingURL=workspaces.umd.min.js.map

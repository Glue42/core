!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):((e=e||self).workspaces=e.workspaces||{},e.workspaces.min=t())}(this,(function(){"use strict";function e(e,t,r,i){return new(r||(r=Promise))((function(n,o){function s(e){try{d(i.next(e))}catch(e){o(e)}}function a(e){try{d(i.throw(e))}catch(e){o(e)}}function d(e){e.done?n(e.value):new r((function(t){t(e.value)})).then(s,a)}d((i=i.apply(e,t||[])).next())}))}function t(e){if(e&&e.errorHandling&&"function"!=typeof e.errorHandling&&"log"!==e.errorHandling&&"silent"!==e.errorHandling&&"throw"!==e.errorHandling)throw new Error('Invalid options passed to createRegistry. Prop errorHandling should be ["log" | "silent" | "throw" | (err) => void], but '+typeof e.errorHandling+" was passed");var t=e&&"function"==typeof e.errorHandling&&e.errorHandling,r={};function i(r,i){var n=r instanceof Error?r:new Error(r);if(t)t(n);else{var o='[ERROR] callback-registry: User callback for key "'+i+'" failed: '+n.stack;if(e)switch(e.errorHandling){case"log":return console.error(o);case"silent":return;case"throw":throw new Error(o)}console.error(o)}}return{add:function(e,t){var i=r[e];return i||(i=[],r[e]=i),i.push(t),function(){var i=r[e];i&&(i=i.reduce((function(e,r,i){return r===t&&e.length===i||e.push(r),e}),[]),r[e]=i)}},execute:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=r[e];if(!o||0===o.length)return[];var s=[];return o.forEach((function(r){try{var n=r.apply(void 0,t);s.push(n)}catch(t){s.push(void 0),i(t,e)}})),s},clear:function(){r={}},clearKey:function(e){r[e]&&delete r[e]}}}t.default=t;var r=t,i=function(e){return{ok:!0,result:e}},n=function(e){return{ok:!1,error:e}},o=function(e){return!0===e.ok?Promise.resolve(e.result):Promise.reject(e.error)},s=function(e,t){return!0===t.ok?t.result:e},a=function(e){if(!0===e.ok)return e.result;throw e.error},d=function(e,t){return!0===t.ok?i(e(t.result)):t},c=function(e,t,r){return!1===t.ok?t:!1===r.ok?r:i(e(t.result,r.result))},l=function(e,t){return!0===t.ok?t:n(e(t.error))},u=function(e,t){return!0===t.ok?e(t.result):t},h=(Object.freeze({ok:i,isOk:function(e){return!0===e.ok},err:n,isErr:function(e){return!1===e.ok},asPromise:o,withDefault:s,withException:a,successes:function(e){return e.reduce((function(e,t){return!0===t.ok?e.concat(t.result):e}),[])},map:d,map2:c,mapError:l,andThen:u}),function(){return(h=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)});var m=function(e){return Array.isArray(e)},f=function(e){return"object"==typeof e&&null!==e&&!m(e)},p=function(e,t){return"expected "+e+", got "+function(e){switch(typeof e){case"string":return"a string";case"number":return"a number";case"boolean":return"a boolean";case"undefined":return"undefined";case"object":return e instanceof Array?"an array":null===e?"null":"an object";default:return JSON.stringify(e)}}(t)},w=function(e){return e.map((function(e){return"string"==typeof e?"."+e:"["+e+"]"})).join("")},g=function(e,t){var r=t.at,i=function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r}(t,["at"]);return h({at:e+(r||"")},i)},v=function(){function e(t){var r=this;this.decode=t,this.run=function(e){return l((function(t){return{kind:"DecoderError",input:e,at:"input"+(t.at||""),message:t.message||""}}),r.decode(e))},this.runPromise=function(e){return o(r.run(e))},this.runWithException=function(e){return a(r.run(e))},this.map=function(t){return new e((function(e){return d(t,r.decode(e))}))},this.andThen=function(t){return new e((function(e){return u((function(r){return t(r).decode(e)}),r.decode(e))}))},this.where=function(t,i){return r.andThen((function(r){return t(r)?e.succeed(r):e.fail(i)}))}}return e.string=function(){return new e((function(e){return"string"==typeof e?i(e):n({message:p("a string",e)})}))},e.number=function(){return new e((function(e){return"number"==typeof e?i(e):n({message:p("a number",e)})}))},e.boolean=function(){return new e((function(e){return"boolean"==typeof e?i(e):n({message:p("a boolean",e)})}))},e.constant=function(t){return new e((function(e){return function e(t,r){if(t===r)return!0;if(null===t&&null===r)return!0;if(typeof t!=typeof r)return!1;if("object"==typeof t){if(Array.isArray(t)){if(!Array.isArray(r))return!1;if(t.length!==r.length)return!1;for(var i=0;i<t.length;i++)if(!e(t[i],r[i]))return!1;return!0}var n=Object.keys(t);if(n.length!==Object.keys(r).length)return!1;for(i=0;i<n.length;i++){if(!r.hasOwnProperty(n[i]))return!1;if(!e(t[n[i]],r[n[i]]))return!1}return!0}}(e,t)?i(t):n({message:"expected "+JSON.stringify(t)+", got "+JSON.stringify(e)})}))},e.object=function(t){return new e((function(e){if(f(e)&&t){var r={};for(var o in t)if(t.hasOwnProperty(o)){var s=t[o].decode(e[o]);if(!0!==s.ok)return void 0===e[o]?n({message:"the key '"+o+"' is required but was not present"}):n(g("."+o,s.error));void 0!==s.result&&(r[o]=s.result)}return i(r)}return f(e)?i(e):n({message:p("an object",e)})}))},e.array=function(t){return new e((function(e){if(m(e)&&t){return e.reduce((function(e,r,i){return c((function(e,t){return e.concat([t])}),e,function(e,r){return l((function(e){return g("["+r+"]",e)}),t.decode(e))}(r,i))}),i([]))}return m(e)?i(e):n({message:p("an array",e)})}))},e.tuple=function(t){return new e((function(e){if(m(e)){if(e.length!==t.length)return n({message:"expected a tuple of length "+t.length+", got one of length "+e.length});for(var r=[],o=0;o<t.length;o++){var s=t[o].decode(e[o]);if(!s.ok)return n(g("["+o+"]",s.error));r[o]=s.result}return i(r)}return n({message:p("a tuple of length "+t.length,e)})}))},e.union=function(t,r){for(var i=[],n=2;n<arguments.length;n++)i[n-2]=arguments[n];return e.oneOf.apply(e,[t,r].concat(i))},e.intersection=function(t,r){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];return new e((function(e){return[t,r].concat(n).reduce((function(t,r){return c(Object.assign,t,r.decode(e))}),i({}))}))},e.anyJson=function(){return new e((function(e){return i(e)}))},e.unknownJson=function(){return new e((function(e){return i(e)}))},e.dict=function(t){return new e((function(e){if(f(e)){var r={};for(var o in e)if(e.hasOwnProperty(o)){var s=t.decode(e[o]);if(!0!==s.ok)return n(g("."+o,s.error));r[o]=s.result}return i(r)}return n({message:p("an object",e)})}))},e.optional=function(t){return new e((function(e){return void 0===e?i(void 0):t.decode(e)}))},e.oneOf=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return new e((function(e){for(var r=[],i=0;i<t.length;i++){var o=t[i].decode(e);if(!0===o.ok)return o;r[i]=o.error}var s=r.map((function(e){return"at error"+(e.at||"")+": "+e.message})).join('", "');return n({message:'expected a value matching one of the decoders, got the errors ["'+s+'"]'})}))},e.withDefault=function(t,r){return new e((function(e){return i(s(t,r.decode(e)))}))},e.valueAt=function(t,r){return new e((function(e){for(var i=e,o=0;o<t.length;o++){if(void 0===i)return n({at:w(t.slice(0,o+1)),message:"path does not exist"});if("string"==typeof t[o]&&!f(i))return n({at:w(t.slice(0,o+1)),message:p("an object",i)});if("number"==typeof t[o]&&!m(i))return n({at:w(t.slice(0,o+1)),message:p("an array",i)});i=i[t[o]]}return l((function(e){return void 0===i?{at:w(t),message:"path does not exist"}:g(w(t),e)}),r.decode(i))}))},e.succeed=function(t){return new e((function(e){return i(t)}))},e.fail=function(t){return new e((function(e){return n({message:t})}))},e.lazy=function(t){return new e((function(e){return t().decode(e)}))},e}(),y=v.string,I=v.number,k=v.boolean,b=v.anyJson,W=v.constant,S=v.object,F=v.array,C=v.optional,D=v.oneOf,x=v.intersection,T=v.lazy;const E=y().where(e=>e.length>0,"Expected a non-empty string"),L=I().where(e=>e>=0,"Expected a non-negative number"),P=S({inWorkspace:k()}),M=D(W("workspace"),W("row"),W("column"),W("group")),A=D(W("row"),W("column"),W("group")),R=(e,t)=>{const r=typeof e;if(t&&"function"!==r&&"undefined"!==r)throw new Error("Provided argument must be either undefined or of type function, provided: "+r);if(!t&&"function"!==r)throw new Error("Provided argument must be of type function, provided: "+r)},z=C(S({saveLayout:C(k())})),O=S({name:E}),B=S({type:C(W("window")),appName:C(E),windowId:C(E)}),j=C(S({type:C(A),children:C(T(()=>F(D(B,j))))})),G=S({type:A,children:C(T(()=>F(D(B,j))))}),U=(D(y().where(e=>"maximized"===e.toLowerCase(),"Expected a case insensitive variation of 'maximized'"),y().where(e=>"normal"===e.toLowerCase(),"Expected a case insensitive variation of 'normal'")),S({bounds:C(S({left:C(I()),top:C(I()),width:C(L),height:C(L)}))})),$=D(W("direct"),W("delayed"),W("lazy")),_=C(S({app:C(E),context:C(b()),restoreType:C($),title:C(E),reuseWorkspaceId:C(E),frameId:C(E),lockdown:C(k()),activateFrame:C(k()),newFrame:C(D(U,k())),inMemoryLayout:C(k())})),N=S({name:E,restoreOptions:C(_)}),J=S({children:C(F(D(B,j))),context:C(b()),config:C(S({title:C(E),position:C(L),isFocused:C(k())})),frame:C(S({reuseFrameId:C(E),newFrame:C(D(k(),U))}))}),H=S({type:M,definition:C(D(J,j))}),K=x(J,S({saveConfig:C(S({saveLayout:C(k())}))})),q=S({itemId:E}),Q=S({id:E}),V=(S({id:E,frameId:E,positionIndex:I(),title:E,focused:k()}),S({type:A,id:E,frameId:E,workspaceId:E,positionIndex:I()}),S({id:C(E),frameId:E,workspaceId:E,positionIndex:I(),isMaximized:k(),title:C(y()),isLoaded:k(),focused:k(),type:W("window")}),S({type:D(W("frame"),W("workspace"),W("container"),W("window")),branch:E})),X=D(W("opened"),W("closing"),W("closed"),W("focus"),W("added"),W("loaded"),W("removed"),W("childrenUpdate"),W("containerChange")),Y=S({frameId:E,title:E,positionIndex:L,name:E}),Z=S({frameId:E,workspaceId:E,positionIndex:L}),ee=b(),te=x(Z,S({windowId:C(E),isMaximized:k(),isLoaded:k(),isFocused:k(),title:C(y())})),re=S({id:E,config:D(ee,te),children:C(T(()=>F(re))),type:D(W("window"),W("row"),W("column"),W("group"))}),ie=S({id:E,config:Y,children:F(re),frameSummary:Q}),ne=S({id:C(E),config:D(ee,te),children:C(T(()=>F(ne))),type:D(W("window"),W("row"),W("column"),W("group"))}),oe=(S({id:C(E),children:F(ne)}),S({type:W("window"),config:S({appName:E,url:C(E)})})),se=S({type:W("group"),config:b(),children:F(D(oe))}),ae=S({type:W("column"),config:b(),children:F(D(se,oe,T(()=>ae),T(()=>de)))}),de=S({type:W("row"),config:b(),children:F(D(ae,se,oe,T(()=>de)))}),ce=S({name:E,type:W("Workspace"),metadata:C(b()),components:F(S({type:W("Workspace"),state:S({config:b(),children:F(D(de,ae,se,oe))})}))}),le=S({layouts:F(ce)}),ue=S({id:E}),he=S({summaries:F(ue)}),me=S({id:E,config:Y}),fe=S({summaries:F(me)}),pe=S({id:E,config:b(),workspaces:F(ie)}),we=S({name:E}),ge=S({summaries:F(we)}),ve=S({windowId:E}),ye=b(),Ie=S({width:C(L),height:C(L),relative:C(k())}),ke=S({top:C(I()),left:C(I()),relative:C(k())}),be=S({itemId:E}),We=S({itemId:E,title:E}),Se=S({itemId:E,containerId:E}),Fe=x(be,Ie),Ce=x(be,ke),De=(S({id:E,type:A}),S({definition:B,parentId:E,parentType:M})),xe=S({definition:G,parentId:E,parentType:M}),Te=S({itemId:E,windowId:C(E)}),Ee=S({type:D(W("row"),W("column")),workspaceId:E}),Le=S({itemId:E,config:ee}),Pe=S({frameSummary:Q}),Me=S({workspaceSummary:me,frameSummary:Q}),Ae=S({containerSummary:Le}),Re=S({windowSummary:S({itemId:E,parentId:E,config:te})}),ze=S({name:E,workspaceId:E}),Oe={control:{name:"T42.Workspaces.Control",isStream:!1},frameStream:{name:"T42.Workspaces.Stream.Frame",isStream:!0},workspaceStream:{name:"T42.Workspaces.Stream.Workspace",isStream:!0},containerStream:{name:"T42.Workspaces.Stream.Container",isStream:!0},windowStream:{name:"T42.Workspaces.Stream.Window",isStream:!0}},Be={frame:{name:"T42.Workspaces.Stream.Frame",payloadDecoder:Pe},workspace:{name:"T42.Workspaces.Stream.Workspace",payloadDecoder:Me},container:{name:"T42.Workspaces.Stream.Container",payloadDecoder:Ae},window:{name:"T42.Workspaces.Stream.Window",payloadDecoder:Re}},je={isWindowInWorkspace:{name:"isWindowInWorkspace",argsDecoder:be,resultDecoder:P},createWorkspace:{name:"createWorkspace",resultDecoder:ie,argsDecoder:K},getAllFramesSummaries:{name:"getAllFramesSummaries",resultDecoder:he},getFrameSummary:{name:"getFrameSummary",resultDecoder:Q,argsDecoder:q},getAllWorkspacesSummaries:{name:"getAllWorkspacesSummaries",resultDecoder:fe},getWorkspaceSnapshot:{name:"getWorkspaceSnapshot",resultDecoder:ie,argsDecoder:be},getAllLayoutsSummaries:{name:"getAllLayoutsSummaries",resultDecoder:ge},openWorkspace:{name:"openWorkspace",argsDecoder:N,resultDecoder:ie},deleteLayout:{name:"deleteLayout",resultDecoder:ye,argsDecoder:O},saveLayout:{name:"saveLayout",resultDecoder:ce,argsDecoder:ze},importLayout:{name:"importLayout",resultDecoder:ye,argsDecoder:ce},exportAllLayouts:{name:"exportAllLayouts",resultDecoder:le},restoreItem:{name:"restoreItem",argsDecoder:be,resultDecoder:ye},maximizeItem:{name:"maximizeItem",argsDecoder:be,resultDecoder:ye},focusItem:{name:"focusItem",argsDecoder:be,resultDecoder:ye},closeItem:{name:"closeItem",argsDecoder:be,resultDecoder:ye},resizeItem:{name:"resizeItem",argsDecoder:Fe,resultDecoder:ye},moveFrame:{name:"moveFrame",argsDecoder:Ce,resultDecoder:ye},getFrameSnapshot:{name:"getFrameSnapshot",argsDecoder:be,resultDecoder:pe},forceLoadWindow:{name:"forceLoadWindow",argsDecoder:be,resultDecoder:ve},ejectWindow:{name:"ejectWindow",argsDecoder:be,resultDecoder:ye},setItemTitle:{name:"setItemTitle",argsDecoder:We,resultDecoder:ye},moveWindowTo:{name:"moveWindowTo",argsDecoder:Se,resultDecoder:ye},addWindow:{name:"addWindow",argsDecoder:De,resultDecoder:Te},addContainer:{name:"addContainer",argsDecoder:xe,resultDecoder:Te},bundleWorkspace:{name:"bundleWorkspace",argsDecoder:Ee,resultDecoder:ye}};class Ge{constructor(e,t){this.bridge=e,this.base=t}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(je.isWindowInWorkspace.name,{itemId:t})).inWorkspace}))}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r});return yield this.base.createWorkspace(e)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);if(null==r?void 0:r.frameId){if(!(yield this.bridge.send(je.getAllFramesSummaries.name)).summaries.some(e=>e.id===r.frameId))throw new Error(`Cannot reuse the frame with id: ${r.frameId}, because there is no frame with that ID found`)}return yield this.base.restoreWorkspace(t,r)}))}add(t,r,i,n){return e(this,void 0,void 0,(function*(){return yield this.base.add(t,r,i,n)}))}processLocalSubscription(e,t){return e.levelId=e.levelId||t,this.bridge.subscribe(e)}processGlobalSubscription(e,t,r){const i={streamType:t,callback:e,action:r,level:"global"};return this.bridge.subscribe(i)}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId)return yield this.base.getFrame(t.windowId);if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(je.getAllFramesSummaries.name);return this.base.getFrames(e.summaries,t)}))}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(je.getAllWorkspacesSummaries.name,{});return this.base.getAllWorkspaceSummaries(e)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getWindow(t);n&&(e=n,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getParent(t);n&&(e=n,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(je.getAllLayoutsSummaries.name)).summaries}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.deleteLayout.name,{name:t})}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(je.exportAllLayouts.name)).layouts.reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}saveLayout(t){return e(this,void 0,void 0,(function*(){return yield this.bridge.send(je.saveLayout.name,{name:t.name,workspaceId:t.workspaceId})}))}importLayout(t){return e(this,void 0,void 0,(function*(){yield Promise.all(t.map(e=>this.bridge.send(je.importLayout.name,e)))}))}bundleTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.bundleTo(t,r)}))}restoreItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.restoreItem(t)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.maximizeItem(t)}))}focusItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.focusItem(t)}))}closeItem(t){return e(this,void 0,void 0,(function*(){return yield this.base.closeItem(t)}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.resizeItem(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){return yield this.base.forceLoadWindow(t)}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){return yield this.base.ejectWindow(t)}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.moveWindowTo(t,r)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.getSnapshot(t,r)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){return yield this.base.setItemTitle(t,r)}))}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const n of i){if(e)return;const i=yield this.base.fetchWorkspace(n.id);t(i,r)}}))}}class Ue{constructor(e,t){this.transport=e,this.registry=t,this.activeSubscriptions=[]}send(t,r,i){return e(this,void 0,void 0,(function*(){if(!window.glue42gd&&!i)throw new Error(`Cannot complete operation: ${t} with args: ${JSON.stringify(r)}, because the environment is Glue42 Core and no frame target was provided`);const e=Object.values(je).find(e=>e.name===t);if(!e)throw new Error("Cannot find definition for operation name: "+t);if(e.argsDecoder)try{e.argsDecoder.runWithException(r)}catch(e){throw new Error(`Unexpected internal outgoing validation error: ${e.message}, for input: ${JSON.stringify(e.input)}`)}let n;try{const t=yield this.transport.transmitControl(e.name,r,i);n=e.resultDecoder.runWithException(t)}catch(e){if(e.kind)throw console.log("Pre exception",t,r),new Error(`Unexpected internal incoming validation error: ${e.message}, for input: ${JSON.stringify(e.input)}`);throw new Error(e.message)}return n}))}subscribe(t){return e(this,void 0,void 0,(function*(){let e=this.getActiveSubscription(t);const r=this.getRegistryKey(t);if(!e){console.log("no active sub will subscribe",t);const r=Be[t.streamType],i=yield this.transport.subscribe(r.name,this.getBranchKey(t),t.streamType);i.onData(e=>{console.log("received from stream",e);const t=e.data,r=V.run(e.requestArguments),i=X.run(t.action);if(!r.ok||!i.ok)return void console.log("the requested arguments weren't ok",e,r,i);const n=r.result.type,o=r.result.branch,s=Be[n].payloadDecoder.run(t.payload);if(!s.ok)return void console.log("the payload wasn't ok",e,s);const a=`${n}-${o}-${i.result}`;console.log("will execute callback",a),this.registry.execute(a,s.result)}),e={streamType:t.streamType,level:t.level,levelId:t.levelId,callbacksCount:0,gdSub:i},this.activeSubscriptions.push(e)}const i=this.registry.add(r,t.callback);return++e.callbacksCount,()=>{i(),--e.callbacksCount,0===e.callbacksCount&&(e.gdSub.close(),this.activeSubscriptions.splice(this.activeSubscriptions.indexOf(e),1))}}))}getBranchKey(e){return"global"===e.level?e.level:`${e.level}_${e.levelId}`}getRegistryKey(e){return`${e.streamType}-${this.getBranchKey(e)}-${e.action}`}getActiveSubscription(e){return this.activeSubscriptions.find(t=>t.streamType===e.streamType&&t.level===e.level&&t.levelId===e.levelId)}}class $e{constructor(e){this.agm=e,this.defaultTransportTimeout=3e4}initiate(){return e(this,void 0,void 0,(function*(){window.glue42gd&&(yield Promise.all(Object.values(Oe).map(e=>this.verifyMethodLive(e.name,e.isStream))))}))}subscribe(t,r,i){return e(this,void 0,void 0,(function*(){const e={branch:r,type:i};let n;try{n=yield this.agm.subscribe(t,{arguments:e})}catch(e){const i=`Internal subscription error! Error details: stream - ${t}, branch: ${r}. Internal message: ${e.message}`;throw new Error(i)}return n}))}transmitControl(t,r,i){return e(this,void 0,void 0,(function*(){if(!this.agm.methods().find(e=>e.name===Oe.control.name))throw new Error(`Cannot complete operation: ${t}, because no control method was found`);const e={operation:t,operationArguments:r};let n;const o=`Internal Swimlane Communication Error. Attempted operation: ${JSON.stringify(e)}. `;try{if(n=yield this.agm.invoke(Oe.control.name,e,i,{methodResponseTimeoutMs:this.defaultTransportTimeout}),!n)throw new Error("Received unsupported result from GD - empty result");if(!Array.isArray(n.all_return_values)||0===n.all_return_values.length)throw new Error("Received unsupported result from GD - empty values collection")}catch(e){if(e&&e.all_errors&&e.all_errors.length){const t=e.all_errors[0].message;throw new Error(`${o} -> Inner message: ${t}`)}throw new Error(`${o} -> Inner message: ${e.message}`)}return n.all_return_values[0].returned}))}verifyMethodLive(e,t){return r=()=>new Promise(r=>{if(this.agm.methods().find(r=>r.name===e&&r.supportsStreaming===t))return void r();let i=this.agm.methodAdded(n=>{n.name===e&&n.supportsStreaming===t&&(i?(i(),i=null):setTimeout(()=>{i&&i()},0),r())})}),i=15e3,n="Timeout waiting for the Swimlane communication channels",new Promise((e,t)=>{let o=!0;const s=setTimeout(()=>{o&&(o=!1,t(n||"Promise timeout hit: "+i))},i);r().then(t=>{o&&(o=!1,clearTimeout(s),e(t))}).catch(e=>{o&&(o=!1,clearTimeout(s),t(e))})});var r,i,n}}const _e=new WeakMap;class Ne{constructor(e,t){const r=t.wrapChildren(e.children);delete e.children,_e.set(this,{base:t,children:r,definition:e})}get type(){return _e.get(this).definition.type}addColumn(e){return _e.get(this).base.add("column",_e.get(this).children,e)}addRow(e){return _e.get(this).base.add("row",_e.get(this).children,e)}addGroup(e){return _e.get(this).base.add("group",_e.get(this).children,e)}addWindow(e){return _e.get(this).base.addWindow(_e.get(this).children,e),this}serialize(){const e=_e.get(this).definition;return e.children=_e.get(this).base.serializeChildren(_e.get(this).children),e}}class Je{constructor(e){this.getBuilder=e}wrapChildren(e){return e.map(e=>"window"===e.type?e:this.getBuilder({type:e.type,definition:e}))}add(e,t,r){const i=j.runWithException(r),n=this.getBuilder({type:e,definition:i});return t.push(n),n}addWindow(e,t){const r=B.runWithException(t);r.type="window",e.push(r)}serializeChildren(e){return e.map(e=>e instanceof Ne?e.serialize():e)}}const He=new WeakMap;class Ke{constructor(e,t,r){const i=t.wrapChildren(e.children);delete e.children,He.set(this,{base:t,children:i,definition:e,controller:r})}addColumn(e){const t=He.get(this).children;if(!t.every(e=>e instanceof Ne&&"column"===e.type))throw new Error("Cannot add a column to this workspace, because there are already children of another type");return He.get(this).base.add("column",t,e)}addRow(e){const t=He.get(this).children;if(!t.every(e=>e instanceof Ne&&"row"===e.type))throw new Error("Cannot add a row to this workspace, because there are already children of another type");return He.get(this).base.add("row",t,e)}addGroup(e){const t=He.get(this).children;if(0!==t.length)throw new Error("Cannot add a group to this workspace, because there are already defined children.");return He.get(this).base.add("group",t,e)}addWindow(e){const t=He.get(this).children;if(0!==t.length)throw new Error("Cannot add a window to this workspace, because there are already defined children.");return He.get(this).base.addWindow(t,e),this}getChildAt(e){L.runWithException(e);return He.get(this).children[e]}create(t){return e(this,void 0,void 0,(function*(){const e=z.runWithException(t),r=He.get(this).definition;r.children=He.get(this).base.serializeChildren(He.get(this).children);return He.get(this).controller.createWorkspace(r,e)}))}}const qe=new WeakMap,Qe=e=>qe.get(e).base;class Ve{constructor(e){qe.set(this,{base:e})}get type(){return"row"}get id(){return Qe(this).getId(this)}get frameId(){return Qe(this).getFrameId(this)}get workspaceId(){return Qe(this).getWorkspaceId(this)}get positionIndex(){return Qe(this).getPositionIndex(this)}get children(){return Qe(this).getAllChildren(this)}get parent(){return Qe(this).getMyParent(this)}get frame(){return Qe(this).getMyFrame(this)}get workspace(){return Qe(this).getMyWorkspace(this)}addWindow(e){return Qe(this).addWindow(this,e,"row")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Qe(this).addParent(this,"group","row",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"column"!==t.type)throw new Error("Expected a column definition, but received "+t.type);return Qe(this).addParent(this,"column","row",t)}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as row children is not supported")}))}removeChild(e){return console.log("in row close will remove child"),Qe(this).removeChild(this,e)}maximize(){return Qe(this).maximize(this)}restore(){return Qe(this).restore(this)}close(){return Qe(this).close(this)}}const Xe=new WeakMap,Ye=e=>Xe.get(e).base;class Ze{constructor(e){Xe.set(this,{base:e})}get type(){return"column"}get id(){return Ye(this).getId(this)}get frameId(){return Ye(this).getFrameId(this)}get workspaceId(){return Ye(this).getWorkspaceId(this)}get positionIndex(){return Ye(this).getPositionIndex(this)}get children(){return Ye(this).getAllChildren(this)}get parent(){return Ye(this).getMyParent(this)}get frame(){return Ye(this).getMyFrame(this)}get workspace(){return Ye(this).getMyWorkspace(this)}addWindow(e){return Ye(this).addWindow(this,e,"column")}addGroup(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"group"!==t.type)throw new Error("Expected a group definition, but received "+t.type);return Ye(this).addParent(this,"group","column",t)}))}addColumn(t){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as column children is not supported")}))}addRow(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.type)&&"row"!==t.type)throw new Error("Expected a row definition, but received "+t.type);return Ye(this).addParent(this,"row","column",t)}))}removeChild(e){return Ye(this).removeChild(this,e)}maximize(){return Ye(this).maximize(this)}restore(){return Ye(this).restore(this)}close(){return Ye(this).close(this)}}const et=new WeakMap,tt=e=>et.get(e).base;class rt{constructor(e){et.set(this,{base:e})}get type(){return"group"}get id(){return tt(this).getId(this)}get frameId(){return tt(this).getFrameId(this)}get workspaceId(){return tt(this).getWorkspaceId(this)}get positionIndex(){return tt(this).getPositionIndex(this)}get children(){return tt(this).getAllChildren(this)}get parent(){return tt(this).getMyParent(this)}get frame(){return tt(this).getMyFrame(this)}get workspace(){return tt(this).getMyWorkspace(this)}addWindow(e){return tt(this).addWindow(this,e,"group")}addGroup(){return e(this,void 0,void 0,(function*(){throw new Error("Adding groups as group child is not supported")}))}addColumn(){return e(this,void 0,void 0,(function*(){throw new Error("Adding columns as group child is not supported")}))}addRow(){return e(this,void 0,void 0,(function*(){throw new Error("Adding rows as group child is not supported")}))}removeChild(e){return tt(this).removeChild(this,e)}maximize(){return tt(this).maximize(this)}restore(){return tt(this).restore(this)}close(){return tt(this).close(this)}}const it=new WeakMap,nt=e=>it.get(e).manager.getWorkspaceData(e),ot=e=>it.get(e).manager;class st{constructor(e){it.set(this,{manager:e})}get id(){return nt(this).id}get frameId(){return nt(this).config.frameId}get positionIndex(){return nt(this).config.positionIndex}get title(){return nt(this).config.title}get children(){return nt(this).children}get frame(){return nt(this).frame}removeChild(t){return e(this,void 0,void 0,(function*(){R(t);const e=this.children.find(t);e&&(yield e.close(),yield this.refreshReference())}))}remove(t){return e(this,void 0,void 0,(function*(){R(t);const e=nt(this).controller.iterateFindChild(this.children,t);yield e.close(),yield this.refreshReference()}))}focus(){return e(this,void 0,void 0,(function*(){yield nt(this).controller.focusItem(this.id),yield this.refreshReference()}))}close(){return e(this,void 0,void 0,(function*(){const e=nt(this).controller,t=1===(yield nt(this).frame.workspaces()).length?nt(this).frame:null;yield e.closeItem(this.id,t)}))}snapshot(){return nt(this).controller.getSnapshot(this.id,"workspace")}saveLayout(t){return e(this,void 0,void 0,(function*(){E.runWithException(t),yield nt(this).controller.saveLayout({name:t,workspaceId:this.id})}))}setTitle(t){return e(this,void 0,void 0,(function*(){E.runWithException(t);const e=nt(this).controller;yield e.setItemTitle(this.id,t),yield this.refreshReference()}))}refreshReference(){return e(this,void 0,void 0,(function*(){const e=yield nt(this).controller.getSnapshot(this.id,"workspace");console.log("new workspace snapshot",e);const t=e.children.reduce((e,t)=>{let r;return r="window"===t.type?this.getWindow(e=>e.id===t.id):this.getParent(e=>e.id===t.id),r&&e.push(r),e},[]),r=nt(this).controller.refreshChildren({existingChildren:t,workspace:this,parent:this,children:e.children}),i=this.frame;let n;if(i.id===e.config.frameId)ot(this).remapFrame(i,e.frameSummary),n=i;else{const t={summary:e.frameSummary};n=nt(this).ioc.getModel("frame",t)}ot(this).remapWorkspace(this,{config:e.config,children:r,frame:n})}))}getParent(e){R(e);const t=nt(this).children;return nt(this).controller.iterateFindChild(t,t=>"window"!==t.type&&e(t))}getAllParents(e){R(e,!0);const t=nt(this).children,r=nt(this).controller.iterateFilterChildren(t,e=>"window"!==e.type);return e?r.filter(e):r}getRow(e){return R(e),this.getParent(t=>"row"===t.type&&e(t))}getAllRows(e){return R(e,!0),e?this.getAllParents(t=>"row"===t.type&&e(t)):this.getAllParents(e=>"row"===e.type)}getColumn(e){return R(e),this.getParent(t=>"column"===t.type&&e(t))}getAllColumns(e){return R(e,!0),e?this.getAllParents(t=>"column"===t.type&&e(t)):this.getAllParents(e=>"column"===e.type)}getGroup(e){return R(e),this.getParent(t=>"group"===t.type&&e(t))}getAllGroups(e){return R(e,!0),e?this.getAllParents(t=>"group"===t.type&&e(t)):this.getAllParents(e=>"group"===e.type)}getWindow(e){R(e);const t=nt(this).children;return nt(this).controller.iterateFindChild(t,t=>"window"===t.type&&e(t))}getAllWindows(e){R(e,!0);const t=nt(this).children,r=nt(this).controller.iterateFilterChildren(t,e=>"window"===e.type);return e?r.filter(e):r}addRow(e){return nt(this).base.addParent(this,"row","workspace",e)}addColumn(e){return nt(this).base.addParent(this,"column","workspace",e)}addGroup(e){return nt(this).base.addParent(this,"group","workspace",e)}addWindow(e){return nt(this).base.addWindow(this,e,"workspace")}bundleToRow(){return e(this,void 0,void 0,(function*(){yield nt(this).controller.bundleTo("row",this.id),yield this.refreshReference()}))}bundleToColumn(){return e(this,void 0,void 0,(function*(){yield nt(this).controller.bundleTo("column",this.id),yield this.refreshReference()}))}onClosing(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"closing",streamType:"workspace",level:"workspace",levelId:r,callback:()=>e(this,void 0,void 0,(function*(){yield this.refreshReference(),t()}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onClosed(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"closed",streamType:"workspace",level:"workspace",levelId:r,callback:()=>e(this,void 0,void 0,(function*(){t()}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onFocusChange(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"focus",streamType:"workspace",level:"workspace",levelId:r,callback:()=>e(this,void 0,void 0,(function*(){yield this.refreshReference(),t()}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"added",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getParent(e=>e.id===r.windowSummary.parentId);console.log("workspace window added payload",r);const i=e.children.find(e=>(console.log("checking child",e),"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex));t(i)}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"removed",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const{windowId:e,workspaceId:i,frameId:n}=r.windowSummary.config;t({windowId:e,workspaceId:i,frameId:n})}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"loaded",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference(),console.log("payload for window loaded",r);const e=this.getWindow(e=>(console.log("Window checked",e),e.id&&e.id===r.windowSummary.config.windowId));console.log("found window",e),t(e)}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onWindowFocusChange(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"focus",streamType:"window",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){this.refreshReference();const e=this.getWindow(e=>e.id&&e.id===r.windowSummary.config.windowId);t(e)}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onParentAdded(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"added",streamType:"container",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getParent(e=>e.id===r.containerSummary.itemId);t(e)}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onParentRemoved(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"removed",streamType:"container",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const{workspaceId:e,frameId:i}=r.containerSummary.config;t({id:r.containerSummary.itemId,workspaceId:e,frameId:i})}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}onParentUpdated(t){return e(this,void 0,void 0,(function*(){R(t);const r=nt(this).id,i={action:"childrenUpdate",streamType:"container",level:"workspace",levelId:r,callback:r=>e(this,void 0,void 0,(function*(){yield this.refreshReference();const e=this.getParent(e=>e.id===r.containerSummary.itemId);t(e)}))};return yield nt(this).controller.processLocalSubscription(i,r)}))}}const at=new WeakMap,dt=e=>at.get(e).manager.getWindowData(e);class ct{constructor(e){at.set(this,{manager:e}),console.log("private data for window",dt(this))}get id(){return dt(this).config.windowId}get type(){return"window"}get frameId(){return dt(this).frame.id}get workspaceId(){return dt(this).workspace.id}get positionIndex(){return dt(this).config.positionIndex}get isMaximized(){return dt(this).config.isMaximized}get isLoaded(){return dt(this).config.isLoaded}get focused(){return dt(this).config.isFocused}get title(){return dt(this).config.title}get workspace(){return dt(this).workspace}get frame(){return dt(this).frame}get parent(){return dt(this).parent}forceLoad(){return e(this,void 0,void 0,(function*(){if(this.isLoaded)return;const e=dt(this).controller,t=dt(this).id,r=yield e.forceLoadWindow(t);console.log("Private data for window",r),dt(this).config.windowId=r,dt(this).config.isLoaded=!0}))}focus(){return e(this,void 0,void 0,(function*(){const e=dt(this).id,t=dt(this).controller;yield t.focusItem(e)}))}close(){return e(this,void 0,void 0,(function*(){const e=dt(this).id,t=dt(this).controller;yield t.closeItem(e),yield dt(this).parent.removeChild(t=>t.id===e)}))}setTitle(t){return e(this,void 0,void 0,(function*(){E.runWithException(t);const e=dt(this).id,r=dt(this).controller;yield r.setItemTitle(e,t)}))}maximize(){return e(this,void 0,void 0,(function*(){const e=dt(this).id,t=dt(this).controller;yield t.maximizeItem(e)}))}restore(){return e(this,void 0,void 0,(function*(){const e=dt(this).id,t=dt(this).controller;yield t.restoreItem(e)}))}eject(){return e(this,void 0,void 0,(function*(){if(!this.isLoaded)throw new Error("Cannot eject this window, because it is not loaded yet");const e=dt(this).id;return yield dt(this).controller.ejectWindow(e),this.getGdWindow()}))}getGdWindow(){if(!this.isLoaded)throw new Error("Cannot fetch this GD window, because the window is not yet loaded");const e=dt(this).config.windowId;return dt(this).controller.getGDWindow(e)}moveTo(t){return e(this,void 0,void 0,(function*(){if(!(t instanceof Ve||t instanceof Ze||t instanceof rt))throw new Error("Cannot add to the provided parent, because the provided parent is not an instance of Row, Column or Group");const e=dt(this).id,r=dt(this).controller;if(!(yield r.getParent(e=>e.id===t.id)))throw new Error("Cannot move the window to the selected parent, because this parent does not exist.");return r.moveWindowTo(e,t.id)}))}onAdded(t){return e(this,void 0,void 0,(function*(){R(t);const r=dt(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"added",streamType:"window",level:"window"};return yield dt(this).controller.processLocalSubscription(i,r)}))}onLoaded(t){return e(this,void 0,void 0,(function*(){R(t);const r=dt(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"loaded",streamType:"window",level:"window"};return yield dt(this).controller.processLocalSubscription(i,r)}))}onParentChanged(t){return e(this,void 0,void 0,(function*(){R(t);const r=dt(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t(this.parent)})),action:"containerChange",streamType:"window",level:"window"};return yield dt(this).controller.processLocalSubscription(i,r)}))}onRemoved(t){return e(this,void 0,void 0,(function*(){R(t);const r=dt(this).id,i={callback:()=>e(this,void 0,void 0,(function*(){yield this.workspace.refreshReference(),t()})),action:"removed",streamType:"window",level:"window"};return yield dt(this).controller.processLocalSubscription(i,r)}))}}const lt=new WeakMap,ut=e=>lt.get(e).manager.getFrameData(e),ht=e=>lt.get(e).manager;class mt{constructor(e){lt.set(this,{manager:e})}get id(){return ut(this).summary.id}resize(e){const t=Ie.runWithException(e),r=ut(this).summary.id;return ut(this).controller.resizeItem(r,t)}move(e){const t=ke.runWithException(e),r=ut(this).summary.id;return ut(this).controller.moveFrame(r,t)}focus(){const e=ut(this).summary.id;return ut(this).controller.focusItem(e)}close(){const e=ut(this).summary.id;return ut(this).controller.closeItem(e)}snapshot(){const e=ut(this).summary.id;return ut(this).controller.getSnapshot(e,"frame")}workspaces(){return e(this,void 0,void 0,(function*(){return ut(this).controller.getWorkspaces(e=>e.frameId===this.id)}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){E.runWithException(t);const e=_.runWithException(r);return ut(this).controller.restoreWorkspace(t,e)}))}createWorkspace(e,t){const r=J.runWithException(e),i=z.runWithException(t);return ut(this).controller.createWorkspace(r,i)}onClosing(t){return e(this,void 0,void 0,(function*(){R(t);const e=ut(this).summary.id,r={callback:e=>{ht(this).remapFrame(this,e.frameSummary),t(this)},action:"closing",streamType:"frame",level:"frame"};return yield ut(this).controller.processLocalSubscription(r,e)}))}onClosed(t){return e(this,void 0,void 0,(function*(){R(t);const e=ut(this).summary.id,r={callback:e=>{t({frameId:e.frameSummary.id})},action:"closed",streamType:"frame",level:"frame"};return yield ut(this).controller.processLocalSubscription(r,e)}))}onFocusChange(t){return e(this,void 0,void 0,(function*(){R(t);const e=ut(this).summary.id,r={callback:e=>{ht(this).remapFrame(this,e.frameSummary),t(this)},action:"focus",streamType:"frame",level:"frame"};return yield ut(this).controller.processLocalSubscription(r,e)}))}onWorkspaceOpened(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ut(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"added",streamType:"workspace",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}onWorkspaceFocusChange(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ut(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"focus",streamType:"workspace",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}onWorkspaceClosing(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ut(this).controller.getWorkspace(e=>e.id===r.workspaceSummary.id);t(e)})),action:"focus",streamType:"workspace",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}onWorkspaceClosed(t){return e(this,void 0,void 0,(function*(){R(t);const e=ut(this).summary.id,r={callback:e=>{console.log("workspace closed callback invoked"),t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},action:"closed",streamType:"workspace",level:"frame"};return yield ut(this).controller.processLocalSubscription(r,e)}))}onWindowAdded(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield ut(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"added",streamType:"window",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}onWindowRemoved(t){return e(this,void 0,void 0,(function*(){R(t);const e=ut(this).summary.id,r={callback:e=>{const{windowId:r,workspaceId:i,frameId:n}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:n})},action:"removed",streamType:"window",level:"frame"};return yield ut(this).controller.processLocalSubscription(r,e)}))}onWindowLoaded(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield ut(this).controller.getParent(e=>(console.log("Parent checked",e),e.id===r.windowSummary.parentId))).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"loaded",streamType:"window",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}onWindowFocusChange(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=(yield ut(this).controller.getParent(e=>e.id===r.windowSummary.parentId)).children.find(e=>"window"===e.type&&e.positionIndex===r.windowSummary.config.positionIndex);t(e)})),action:"focus",streamType:"window",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}onParentAdded(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ut(this).controller.getParent(e=>e.id===r.containerSummary.itemId);t(e)})),action:"added",streamType:"container",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}onParentRemoved(t){return e(this,void 0,void 0,(function*(){R(t);const e=ut(this).summary.id,r={callback:e=>{const{workspaceId:r,frameId:i}=e.containerSummary.config;t({id:e.containerSummary.itemId,workspaceId:r,frameId:i})},action:"removed",streamType:"container",level:"frame"};return yield ut(this).controller.processLocalSubscription(r,e)}))}onParentUpdated(t){return e(this,void 0,void 0,(function*(){R(t);const r=ut(this).summary.id,i={callback:r=>e(this,void 0,void 0,(function*(){const e=yield ut(this).controller.getParent(e=>e.id===r.containerSummary.itemId);t(e)})),action:"childrenUpdate",streamType:"container",level:"frame"};return yield ut(this).controller.processLocalSubscription(i,r)}))}}class ft{constructor(){this.parentsData=new WeakMap,this.workspacesData=new WeakMap,this.windowsData=new WeakMap,this.framesData=new WeakMap,this.windowPlacementIdData={}}deleteData(e){if(e instanceof ct){const t=Object.keys(this.windowPlacementIdData).find(t=>this.windowPlacementIdData[t]===e);t&&delete this.windowPlacementIdData[t],this.windowsData.delete(e)}e instanceof st&&this.workspacesData.delete(e),(e instanceof Ve||e instanceof Ze||e instanceof rt)&&this.parentsData.delete(e),e instanceof mt&&this.framesData.delete(e)}setWindowData(e,t){console.log("setting window data",t),this.windowPlacementIdData[t.id]=e,this.windowsData.set(e,t)}setWorkspaceData(e,t){this.workspacesData.set(e,t)}setParentData(e,t){this.parentsData.set(e,t)}setFrameData(e,t){this.framesData.set(e,t)}getWindowData(e){return this.windowsData.get(e)}getWindowByPlacementId(e){return this.windowPlacementIdData[e]}getWorkspaceData(e){return this.workspacesData.get(e)}getParentData(e){return this.parentsData.get(e)}getFrameData(e){return this.framesData.get(e)}remapChild(e,t){if(e instanceof ct){const r=this.windowsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config}if(e instanceof Ve||e instanceof Ze||e instanceof rt){const r=this.parentsData.get(e);r.parent=t.parent||r.parent,r.config=t.config||r.config,r.children=t.children||r.children}}remapFrame(e,t){this.framesData.get(e).summary=t}remapWorkspace(e,t){const r=this.workspacesData.get(e);r.frame=t.frame||r.frame,r.config=t.config||r.config,r.children=t.children||r.children}}const pt=new WeakMap,wt=(e,t)=>{const r=pt.get(e).manager;return t instanceof st?r.getWorkspaceData(t):pt.get(e).manager.getParentData(t)},gt=(e,t)=>pt.get(e).manager.getWindowByPlacementId(t);class vt{constructor(e){pt.set(this,{manager:e})}getId(e){return wt(this,e).id}getPositionIndex(e){return wt(this,e).config.positionIndex}getWorkspaceId(e){const t=wt(this,e);return t.config.workspaceId||t.workspace.id}getFrameId(e){return wt(this,e).frame.id}getAllChildren(e,t){R(t,!0);const r=wt(this,e).children;return void 0===t?r:r.filter(t)}getMyParent(e){if(!(e instanceof st))return wt(this,e).parent}getMyFrame(e){return wt(this,e).frame}getMyWorkspace(e){if(!(e instanceof st))return wt(this,e).workspace}addWindow(t,r,i){return e(this,void 0,void 0,(function*(){if(!r.appName&&!r.windowId)throw new Error("The window definition should contain either an appName or a windowId");const e=B.runWithException(r),n=wt(this,t).controller,o=yield n.add("window",wt(this,t).id,i,e);return console.log("add window operation reuslt",o),t instanceof st?(yield t.refreshReference(),gt(this,o.itemId)):(yield this.getMyWorkspace(t).refreshReference(),gt(this,o.itemId))}))}addParent(t,r,i,n){return e(this,void 0,void 0,(function*(){const e=this.transformDefinition(r,n),o=wt(this,t).controller,s=(yield o.add("container",wt(this,t).id,i,e)).itemId;if(t instanceof st)return yield t.refreshReference(),t.getParent(e=>e.id===s);const a=this.getMyWorkspace(t);return yield a.refreshReference(),a.getParent(e=>e.id===s)}))}removeChild(t,r){return e(this,void 0,void 0,(function*(){R(r);const e=this.getAllChildren(t).find(r);if(e){if(console.log("will close child"),yield e.close(),t instanceof st)return console.log("will get reference 1",t.children),yield t.refreshReference(),void console.log("allchildren",t.children);console.log("will get reference",t.children),yield this.getMyWorkspace(t).refreshReference(),console.log("allchildren",t.children)}}))}maximize(t){return e(this,void 0,void 0,(function*(){const e=wt(this,t).controller;yield e.maximizeItem(wt(this,t).id)}))}restore(t){return e(this,void 0,void 0,(function*(){const e=wt(this,t).controller;yield e.restoreItem(wt(this,t).id)}))}close(t){return e(this,void 0,void 0,(function*(){const e=wt(this,t),r=wt(this,t).controller;yield r.closeItem(e.id),e.parent instanceof st?(yield e.parent.refreshReference(),console.log("workspace reference refreshed",e.parent.children)):(yield this.getMyWorkspace(e.parent).refreshReference(),console.log(" reference refreshed",e.parent.children))}))}transformDefinition(e,t){let r;return void 0===t?r={type:e,children:[]}:t instanceof Ne?r=t.serialize():(void 0===t.type&&(t.type=e),r=G.runWithException(t),r.children=r.children||[]),r}}class yt{constructor(e,t,r,i){this.bridge=e,this.frameUtils=t,this.layouts=r,this.base=i}checkIsInSwimlane(t){return e(this,void 0,void 0,(function*(){const e=this.frameUtils.getAllFrameInstances();if(!e.length)return!1;return(yield Promise.all(e.map(e=>this.bridge.send(je.isWindowInWorkspace.name,{itemId:t},e)))).some(e=>e.inWorkspace)}))}createWorkspace(t,r){var i,n;return e(this,void 0,void 0,(function*(){const e=Object.assign({},t,{saveConfig:r}),o={frameId:null===(i=t.frame)||void 0===i?void 0:i.reuseFrameId,newFrame:null===(n=t.frame)||void 0===n?void 0:n.newFrame},s=yield this.frameUtils.getFrameInstance(o),a=yield this.base.createWorkspace(e,s);return yield this.frameUtils.focusFrame(s),a}))}restoreWorkspace(t,r){return e(this,void 0,void 0,(function*(){if(!(yield this.getLayoutSummaries()).some(e=>e.name===t))throw new Error(`This layout: ${t} cannot be restored, because it doesn't exist.`);const e=yield this.frameUtils.getFrameInstance({frameId:null==r?void 0:r.frameId,newFrame:null==r?void 0:r.newFrame}),i=yield this.base.restoreWorkspace(t,r,e);return yield this.frameUtils.focusFrame(e),i}))}add(t,r,i,n){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(r);return yield this.base.add(t,r,i,n,e)}))}processLocalSubscription(){return e(this,void 0,void 0,(function*(){throw new Error("Workspaces events are not supported in Glue42 Core.")}))}processGlobalSubscription(){return e(this,void 0,void 0,(function*(){throw new Error("Workspaces events are not supported in Glue42 Core.")}))}getFrame(t){return e(this,void 0,void 0,(function*(){if(t.windowId){const e=yield this.frameUtils.getFrameInstanceByItemId(t.windowId);return yield this.base.getFrame(t.windowId,e)}if(t.predicate)return(yield this.getFrames(t.predicate))[0];throw new Error("The provided selector is not valid: "+JSON.stringify(t))}))}getFrames(t){return e(this,void 0,void 0,(function*(){const e=this.frameUtils.getAllFrameInstances(),r=yield Promise.all(e.map(e=>this.bridge.send(je.getFrameSummary.name,{itemId:e.peerId},e)));return this.base.getFrames(r,t)}))}getWorkspace(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{t(r)&&(e=r,i())}),e}))}getWorkspaces(t){return e(this,void 0,void 0,(function*(){const e=[];return yield this.iterateWorkspaces(r=>{t&&!t(r)||e.push(r)}),e}))}getAllWorkspaceSummaries(){return e(this,void 0,void 0,(function*(){const e=this.frameUtils.getAllFrameInstances(),t=yield Promise.all(e.map(e=>this.bridge.send(je.getAllWorkspacesSummaries.name,{},e)));return this.base.getAllWorkspaceSummaries(...t)}))}getWindow(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getWindow(t);n&&(e=n,i())}),e}))}getParent(t){return e(this,void 0,void 0,(function*(){let e;return yield this.iterateWorkspaces((r,i)=>{const n=r.getParent(t);n&&(e=n,i())}),e}))}getLayoutSummaries(){return e(this,void 0,void 0,(function*(){return(yield this.layouts.getAll("Workspace")).map(e=>({name:e.name}))}))}deleteLayout(t){return e(this,void 0,void 0,(function*(){yield this.layouts.remove("Workspace",t)}))}exportLayout(t){return e(this,void 0,void 0,(function*(){return(yield this.layouts.export("Workspace")).reduce((e,r)=>(t&&!t(r)||e.push(r),e),[])}))}importLayout(t){return e(this,void 0,void 0,(function*(){yield this.layouts.import(t)}))}saveLayout(t){return e(this,void 0,void 0,(function*(){if(!this.frameUtils.getAllFrameInstances().length)throw new Error(`Cannot save the layout with config: ${JSON.stringify(t)}, because no active frames were found`);const e=yield this.frameUtils.getFrameInstanceByItemId(t.workspaceId);return yield this.bridge.send(je.saveLayout.name,{name:t.name,workspaceId:t.workspaceId},e)}))}bundleTo(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(r);return yield this.base.bundleTo(t,r,e)}))}restoreItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.restoreItem(t,e)}))}maximizeItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.maximizeItem(t,e)}))}focusItem(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.focusItem(t,e)}))}closeItem(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t),i=t===e.peerId;return yield this.base.closeItem(t,e),i?yield this.frameUtils.closeFrame(e):r?yield r.close():void 0}))}resizeItem(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.resizeItem(t,r,e),yield this.frameUtils.resizeFrame(t,r)}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);yield this.base.moveFrame(t,r,e),yield this.frameUtils.moveFrame(t,r)}))}getGDWindow(e){return this.base.getGDWindow(e)}forceLoadWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.forceLoadWindow(t,e)}))}ejectWindow(t){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.ejectWindow(t,e)}))}moveWindowTo(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.moveWindowTo(t,r,e)}))}getSnapshot(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.getSnapshot(t,r,e)}))}setItemTitle(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.frameUtils.getFrameInstanceByItemId(t);return yield this.base.setItemTitle(t,r,e)}))}refreshChildren(e){return this.base.refreshChildren(e)}iterateFindChild(e,t){return this.base.iterateFindChild(e,t)}iterateFilterChildren(e,t){return this.base.iterateFilterChildren(e,t)}iterateWorkspaces(t){return e(this,void 0,void 0,(function*(){let e=!1;const r=()=>{e=!0},i=yield this.getAllWorkspaceSummaries();for(const n of i){if(e)return;const i=yield this.frameUtils.getFrameInstance({frameId:n.frameId}),o=yield this.base.fetchWorkspace(n.id,i);t(o,r)}}))}}class It{constructor(e,t,r,i){this.interop=e,this.windows=t,this.bridge=r,this.assetsBaseLocation=i,this.workspacesIndex="/workspaces/",this.defaultAssetsBase="/glue",this.defaultWidth=1280,this.defaultHeight=720;const n=location.href.includes("csb.app")?"/index.html":"";this.workspacesRoute=`${this.assetsBaseLocation||this.defaultAssetsBase}${this.workspacesIndex}${n}`}getAllFrameInstances(){return this.interop.servers().filter(e=>{var t;if(null==e?void 0:e.getMethods)return null===(t=e.getMethods())||void 0===t?void 0:t.some(e=>e.name===Oe.control.name)})}focusFrame(t){return e(this,void 0,void 0,(function*(){const e=this.windows.list().find(e=>e.id===t.windowId);console.log("calling the undelying window focus"),yield e.focus()}))}getFrameInstance(t){return e(this,void 0,void 0,(function*(){if((null==t?void 0:t.frameId)&&(null==t?void 0:t.newFrame))throw new Error("Cannot retrieve the frame, because of over-specification: both frameId and newFrame were provided.");const e=this.getAllFrameInstances();if(null==t?void 0:t.frameId){const r=e.find(e=>e.peerId===t.frameId);if(!r)throw new Error(`Frame with id: ${t.frameId} was not found`);return r}return(null==t?void 0:t.newFrame)?this.openNewWorkspacesFrame(t.newFrame):e.length?this.getLastFrameInteropInstance():this.openNewWorkspacesFrame()}))}getFrameInstanceByItemId(t){return e(this,void 0,void 0,(function*(){const e=this.getAllFrameInstances(),r=(yield Promise.all(e.map(e=>this.bridge.send(je.getFrameSummary.name,{itemId:t},e)))).find(e=>"none"!==e.id);if(!r)throw new Error("Cannot find frame for item: "+t);return yield this.getFrameInstance({frameId:r.id})}))}getLastFrameInteropInstance(){return this.getAllFrameInstances().sort((e,t)=>{const r=(null==e?void 0:e.peerId)?+e.peerId.slice(e.peerId.lastIndexOf("-")+1):0;return((null==t?void 0:t.peerId)?+t.peerId.slice(t.peerId.lastIndexOf("-")+1):0)-r})[0]}openNewWorkspacesFrame(e){return new Promise((t,r)=>{var i,n;const o=this.getAllFrameInstances().length;let s;const a=this.interop.serverMethodAdded(e=>{if(!(null==e?void 0:e.server)||!(null==e?void 0:e.method))return;const r=e.method.name===Oe.control.name,i=e.server.windowId===(null==s?void 0:s.id);(null==s?void 0:s.id)&&r&&i&&(a(),t(e.server))}),d={url:this.workspacesRoute+"?emptyFrame=true",width:"object"==typeof e&&(null===(i=e.bounds)||void 0===i?void 0:i.width)||this.defaultWidth,height:"object"==typeof e&&(null===(n=e.bounds)||void 0===n?void 0:n.height)||this.defaultHeight};this.windows.open("frame_"+(o+1),d.url,d).then(e=>{s=e;const r=this.interop.servers().find(e=>{const t=e.windowId===s.id,r=e.getMethods().some(e=>e.name===Oe.control.name);return t&&r});r&&(a(),t(r))}).catch(r)})}closeFrame(t){return e(this,void 0,void 0,(function*(){const e=this.windows.list().find(e=>e.id===t.windowId);yield e.close()}))}moveFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.getFrameInstanceByItemId(t);if(t!==e.peerId)return;const i=this.windows.list().find(t=>t.id===e.windowId);r.relative?yield i.moveTo(r.top,r.left):yield i.moveResize({top:r.top,left:r.left})}))}resizeFrame(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.getFrameInstanceByItemId(t);if(t!==e.peerId)return;const i=this.windows.list().find(t=>t.id===e.windowId);r.relative?yield i.resizeTo(r.width,r.height):yield i.moveResize({width:r.width,height:r.height})}))}}class kt{constructor(e,t){this.ioc=e,this.windows=t}get bridge(){return this.ioc.bridge}get privateDataManager(){return this.ioc.privateDataManager}createWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(je.createWorkspace.name,t,r),i={summary:e.frameSummary},n={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",n)}))}restoreWorkspace(t,r,i){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(je.openWorkspace.name,{name:t,restoreOptions:r},i),n={summary:yield this.bridge.send(je.getFrameSummary.name,{itemId:e.config.frameId},i)},o={frame:this.ioc.getModel("frame",n),snapshot:e};return this.ioc.getModel("workspace",o)}))}add(t,r,i,n,o){return e(this,void 0,void 0,(function*(){let e;const s={definition:n,parentId:r,parentType:i};if("window"===t)e=je.addWindow.name;else{if("container"!==t)throw new Error("Unrecognized add type: "+t);e=je.addContainer.name}return yield this.bridge.send(e,s,o)}))}getFrame(t,r){return e(this,void 0,void 0,(function*(){const e={summary:yield this.bridge.send(je.getFrameSummary.name,{itemId:t},r)};return this.ioc.getModel("frame",e)}))}getFrames(e,t){return e.reduce((e,r)=>{const i={summary:r},n=this.ioc.getModel("frame",i);return t&&!t(n)||e.push(n),e},[])}getAllWorkspaceSummaries(...e){return e.reduce((e,t)=>(e.push(...t.summaries),e),[]).map(e=>({id:e.id,frameId:e.config.frameId,positionIndex:e.config.positionIndex,title:e.config.title}))}fetchWorkspace(t,r){return e(this,void 0,void 0,(function*(){const e=yield this.bridge.send(je.getWorkspaceSnapshot.name,{itemId:t},r),i={summary:e.frameSummary},n={frame:this.ioc.getModel("frame",i),snapshot:e};return this.ioc.getModel("workspace",n)}))}bundleTo(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.bundleWorkspace.name,{type:t,workspaceId:r},i)}))}restoreItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.restoreItem.name,{itemId:t},r)}))}maximizeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.maximizeItem.name,{itemId:t},r)}))}focusItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.focusItem.name,{itemId:t},r)}))}closeItem(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.closeItem.name,{itemId:t},r)}))}resizeItem(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.resizeItem.name,Object.assign({},{itemId:t},r),i)}))}moveFrame(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.moveFrame.name,Object.assign({},{itemId:t},r),i)}))}getGDWindow(e){return this.windows.list().find(t=>t.id===e)}forceLoadWindow(t,r){return e(this,void 0,void 0,(function*(){return(yield this.bridge.send(je.forceLoadWindow.name,{itemId:t},r)).windowId}))}ejectWindow(t,r){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.ejectWindow.name,{itemId:t},r)}))}moveWindowTo(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.moveWindowTo.name,{itemId:t,containerId:r},i)}))}getSnapshot(t,r,i){return e(this,void 0,void 0,(function*(){let e;return"workspace"===r?e=yield this.bridge.send(je.getWorkspaceSnapshot.name,{itemId:t},i):"frame"===r&&(e=yield this.bridge.send(je.getFrameSnapshot.name,{itemId:t},i)),e}))}setItemTitle(t,r,i){return e(this,void 0,void 0,(function*(){yield this.bridge.send(je.setItemTitle.name,{itemId:t,title:r},i)}))}refreshChildren(e){const{parent:t,children:r,existingChildren:i,workspace:n}=e;if(t instanceof ct)return;const o=r.map(e=>{let r=i.find(t=>t.id===e.id);const o=e.type;if(r)this.privateDataManager.remapChild(r,{parent:t,children:[],config:e.config});else if("window"===o){const i={id:e.id,parent:t,frame:n.frame,workspace:n,config:e.config};r=this.ioc.getModel(o,i)}else{const i={id:e.id,children:[],parent:t,frame:n.frame,workspace:n,config:e.config};r=this.ioc.getModel(o,i)}return"window"!==o&&this.refreshChildren({workspace:n,existingChildren:i,children:e.children,parent:r}),r});return t instanceof st||this.privateDataManager.remapChild(t,{children:o}),o}iterateFindChild(e,t){let r=e.find(e=>t(e));return r||(e.some(e=>!(e instanceof ct)&&(r=this.iterateFindChild(e.children,t),!!r||void 0)),r)}iterateFilterChildren(e,t){const r=e.filter(e=>t(e)),i=e.reduce((e,r)=>(r instanceof ct||e.push(...this.iterateFilterChildren(r.children,t)),e),[]);return r.push(...i),r}}class bt{constructor(e,t,r,i){this.agm=e,this.windows=t,this.layouts=r,this.assetsBaseLocation=i}get baseController(){return this._baseController||(this._baseController=new kt(this,this.windows)),this._baseController}get controller(){return this._controllerInstance||(this._controllerInstance=window.glue42gd?new Ge(this.bridge,this.baseController):new yt(this.bridge,new It(this.agm,this.windows,this.bridge,this.assetsBaseLocation),this.layouts,this.baseController)),this._controllerInstance}get bridge(){return this._bridgeInstance||(this._bridgeInstance=new Ue(this.transport,r())),this._bridgeInstance}get transport(){return this._transportInstance||(this._transportInstance=new $e(this.agm)),this._transportInstance}get privateDataManager(){return this._privateDataManagerInstance||(this._privateDataManagerInstance=new ft),this._privateDataManagerInstance}get parentBase(){return this._parentBaseInstance||(this._parentBaseInstance=new vt(this.privateDataManager)),this._parentBaseInstance}initiate(){return e(this,void 0,void 0,(function*(){yield this.transport.initiate()}))}getModel(e,t){switch(e){case"frame":{const e=new mt(this.privateDataManager),{summary:r}=t,i={summary:r,controller:this.controller};return this.privateDataManager.setFrameData(e,i),e}case"window":{const{id:e,parent:r,frame:i,workspace:n,config:o}=t,s={type:"window",controller:this.controller,config:o,id:e,parent:r,frame:i,workspace:n},a=new ct(this.privateDataManager);return this.privateDataManager.setWindowData(a,s),a}case"row":case"column":case"group":{const{id:r,children:i,parent:n,frame:o,workspace:s,config:a}=t,d="column"===e?new Ze(this.parentBase):"row"===e?new Ve(this.parentBase):new rt(this.parentBase),c=this.buildChildren(i,o,s,d),l={id:r,parent:n,frame:o,workspace:s,config:a,type:e,controller:this.controller,children:c};return this.privateDataManager.setParentData(d,l),d}case"workspace":{const{snapshot:e,frame:r}=t,i=new st(this.privateDataManager);console.log("building children with this snapshot",e);const n=this.buildChildren(e.children,r,i,i),o={id:e.id,type:"workspace",config:e.config,base:this.parentBase,controller:this.controller,children:n,frame:r,ioc:this};return this.privateDataManager.setWorkspaceData(i,o),i}default:throw new Error("Unrecognized type: "+e)}}getBuilder(e){e.definition=e.definition||{},Array.isArray(e.definition.children)||(e.definition.children=[]);const t=new Je(this.getBuilder.bind(this));switch(e.type){case"workspace":return new Ke(e.definition,t,this.controller);case"row":case"column":case"group":return e.definition.type=e.type,new Ne(e.definition,t);default:throw new Error("Unexpected Builder creation error, provided config: "+JSON.stringify(e))}}buildChildren(e,t,r,i){return e.map(e=>{switch(e.type){case"window":return this.getModel("window",{id:e.id,config:e.config,frame:t,workspace:r,parent:i});case"column":case"row":case"group":return this.getModel(e.type,{id:e.id,config:e.config,children:e.children,frame:t,workspace:r,parent:i});default:throw new Error("Unsupported child type: "+e.type)}})}}const Wt=(t,r)=>e(void 0,void 0,void 0,(function*(){var i;const n=new bt(t.agm,t.windows,t.layouts,null===(i=null==r?void 0:r.assets)||void 0===i?void 0:i.location);yield n.initiate(),t.workspaces=((t,r)=>{const i=r.controller;return{inWorkspace:()=>{const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");return i.checkIsInSwimlane(e)},getBuilder:e=>{const t=H.runWithException(e);return r.getBuilder(t)},getMyFrame:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my frame, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your frame, because this window is not in a workspace");return i.getFrame({windowId:e})})),getFrame:t=>e(void 0,void 0,void 0,(function*(){return R(t),i.getFrame({predicate:t})})),getAllFrames:t=>e(void 0,void 0,void 0,(function*(){return R(t,!0),i.getFrames(t)})),getAllWorkspacesSummaries:()=>i.getAllWorkspaceSummaries(),getMyWorkspace:()=>e(void 0,void 0,void 0,(function*(){const e=t.windows.my().id;if(!e)throw new Error("Cannot get my workspace, because my id is undefined.");if(!(yield i.checkIsInSwimlane(e)))throw new Error("Cannot fetch your workspace, because this window is not in a workspace");return(yield i.getWorkspaces(t=>!!t.getWindow(t=>t.id===e)))[0]})),getWorkspace:t=>e(void 0,void 0,void 0,(function*(){return R(t),(yield i.getWorkspaces(t))[0]})),getAllWorkspaces:e=>(R(e,!0),i.getWorkspaces(e)),getWindow:t=>e(void 0,void 0,void 0,(function*(){return R(t),i.getWindow(t)})),getParent:t=>e(void 0,void 0,void 0,(function*(){return R(t),i.getParent(t)})),restoreWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){E.runWithException(t);const e=_.runWithException(r);return i.restoreWorkspace(t,e)})),createWorkspace:(t,r)=>e(void 0,void 0,void 0,(function*(){const e=J.runWithException(t),n=z.runWithException(r);return i.createWorkspace(e,n)})),layouts:{getSummaries:()=>i.getLayoutSummaries(),delete:t=>e(void 0,void 0,void 0,(function*(){return E.runWithException(t),i.deleteLayout(t)})),export:t=>e(void 0,void 0,void 0,(function*(){return R(t,!0),i.exportLayout(t)})),import:t=>e(void 0,void 0,void 0,(function*(){if(!Array.isArray(t))throw new Error("The provided layouts argument is not an array: "+JSON.stringify(t));return t.forEach(e=>ce.runWithException(e)),i.importLayout(t)})),save:t=>e(void 0,void 0,void 0,(function*(){const e=ze.runWithException(t);return i.saveLayout(e)}))},onFrameOpened:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},n=r.getModel("frame",i);t(n)},"frame","opened")})),onFrameClosing:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},n=r.getModel("frame",i);t(n)},"frame","closing")})),onFrameClosed:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id})},"frame","closed")})),onFrameFocusChange:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(e=>{const i={summary:e.frameSummary},n=r.getModel("frame",i);t(n)},"frame","focus")})),onWorkspaceOpened:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e={summary:n.frameSummary},o={frame:r.getModel("frame",e),snapshot:yield i.getSnapshot(n.workspaceSummary.id,"workspace")},s=r.getModel("workspace",o);t(s)})),"workspace","opened")})),onWorkspaceClosing:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e={summary:n.frameSummary},o={frame:r.getModel("frame",e),snapshot:yield i.getSnapshot(n.workspaceSummary.id,"workspace")},s=r.getModel("workspace",o);t(s)})),"workspace","closing")})),onWorkspaceClosed:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(e=>{t({frameId:e.frameSummary.id,workspaceId:e.workspaceSummary.id})},"workspace","closed")})),onWorkspaceFocusChange:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e={summary:n.frameSummary},o={frame:r.getModel("frame",e),snapshot:yield i.getSnapshot(n.workspaceSummary.id,"workspace")},s=r.getModel("workspace",o);t(s)})),"workspace","focus")})),onWindowAdded:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getParent(e=>e.id===n.windowSummary.parentId).children.find(e=>"window"===e.type&&e.positionIndex===n.windowSummary.config.positionIndex);t(a)})),"window","added")})),onWindowLoaded:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getWindow(e=>e.id&&e.id===n.windowSummary.config.windowId);t(a)})),"window","loaded")})),onWindowRemoved:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(e=>{const{windowId:r,workspaceId:i,frameId:n}=e.windowSummary.config;t({windowId:r,workspaceId:i,frameId:n})},"window","removed")})),onWindowFocusChange:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.windowSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getWindow(e=>e.id&&e.id===n.windowSummary.config.windowId);t(a)})),"window","focus")})),onParentAdded:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(n=>e(void 0,void 0,void 0,(function*(){const e=yield i.getSnapshot(n.containerSummary.config.workspaceId,"workspace"),o={summary:e.frameSummary},s={frame:r.getModel("frame",o),snapshot:e},a=r.getModel("workspace",s).getParent(e=>e.id===n.containerSummary.itemId);t(a)})),"container","added")})),onParentRemoved:t=>e(void 0,void 0,void 0,(function*(){R(t);return yield i.processGlobalSubscription(e=>{const{workspaceId:r,frameId:i}=e.containerSummary.config;t({id:e.containerSummary.itemId,workspaceId:r,frameId:i})},"container","removed")}))}})(t,n)}));return"undefined"!=typeof window&&(window.GlueWorkspaces=Wt),Wt}));
//# sourceMappingURL=workspaces.umd.min.js.map
